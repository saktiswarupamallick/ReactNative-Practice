{"version":3,"file":"clientInstallAndroidAsync.js","names":["_chalk","data","_interopRequireDefault","require","_xdl","_log","_prompts","_resolveDeviceAsync","ClientUpgradeUtils","_interopRequireWildcard","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","actionAsync","options","device","resolveDeviceAsync","forceLatest","latest","currentSdkConfig","getExpoSdkConfig","process","cwd","currentSdkVersion","sdkVersion","undefined","sdkVersions","Versions","sdkVersionsAsync","latestSdk","newestReleasedSdkVersionAsync","currentSdk","recommendedClient","getClient","latestClient","url","Log","error","chalk","bold","Android","upgradeExpoAsync","version","log","recommendedClientVersion","answer","confirmAsync","message","availableClients","getAvailableClients","project","platform","length","targetClient","askClientToInstall","latestSdkVersion","clients","clientUrl"],"sources":["../../../src/commands/client/clientInstallAndroidAsync.ts"],"sourcesContent":["import chalk from 'chalk';\nimport { Android, Versions } from 'xdl';\n\nimport Log from '../../log';\nimport { confirmAsync } from '../../utils/prompts';\nimport { resolveDeviceAsync } from '../run/android/resolveDeviceAsync';\nimport * as ClientUpgradeUtils from '../utils/ClientUpgradeUtils';\n\ntype Options = {\n  latest?: boolean;\n  device?: boolean | string;\n};\n\nexport async function actionAsync(options: Options) {\n  const device = await resolveDeviceAsync(options.device);\n  const forceLatest = !!options.latest;\n  const currentSdkConfig = await ClientUpgradeUtils.getExpoSdkConfig(process.cwd());\n  const currentSdkVersion = currentSdkConfig ? currentSdkConfig.sdkVersion : undefined;\n  const sdkVersions = await Versions.sdkVersionsAsync();\n  const latestSdk = await Versions.newestReleasedSdkVersionAsync();\n  const currentSdk = sdkVersions[currentSdkVersion!];\n  const recommendedClient = ClientUpgradeUtils.getClient('android', currentSdk);\n  const latestClient = ClientUpgradeUtils.getClient('android', latestSdk.data);\n\n  if (forceLatest) {\n    if (!latestClient?.url) {\n      Log.error(\n        `Unable to find latest client version. Check your internet connection or run this command again without the ${chalk.bold(\n          '--latest'\n        )} flag.`\n      );\n      return;\n    }\n\n    if (\n      await Android.upgradeExpoAsync({\n        device,\n        url: latestClient.url,\n        version: latestClient.version,\n      })\n    ) {\n      Log.log('Done!');\n    } else {\n      Log.error(`Unable to install Expo Go ${latestClient.version} for Android.`);\n    }\n\n    return;\n  }\n\n  if (!currentSdkVersion) {\n    Log.log(\n      'Could not find your Expo project. If you run this from a project, we can help pick the right Expo Go version!'\n    );\n  }\n\n  if (currentSdk && !recommendedClient) {\n    Log.log(\n      `You are currently using SDK ${currentSdkVersion}. Unfortunately, we couldn't detect the proper client version for this SDK.`\n    );\n  }\n\n  if (currentSdk && recommendedClient) {\n    const recommendedClientVersion = recommendedClient.version || 'version unknown';\n    const answer = await confirmAsync({\n      message: `You are currently using SDK ${currentSdkVersion}. Would you like to install client ${recommendedClientVersion} released for this SDK?`,\n    });\n    if (answer) {\n      await Android.upgradeExpoAsync({\n        device,\n        url: recommendedClient.url,\n        version: recommendedClient.version,\n      });\n      Log.log('Done!');\n      return;\n    }\n  } else {\n    const answer = await confirmAsync({\n      message: latestClient?.version\n        ? chalk`Do you want to install the latest client? {dim (${latestClient.version})}`\n        : 'Do you want to install the latest client?',\n    });\n    if (answer) {\n      await Android.upgradeExpoAsync({\n        device,\n        url: latestClient?.url,\n        version: latestClient?.version,\n      });\n      Log.log('Done!');\n      return;\n    }\n  }\n\n  const availableClients = ClientUpgradeUtils.getAvailableClients({\n    sdkVersions,\n    project: currentSdkConfig,\n    platform: 'android',\n  });\n\n  if (availableClients.length === 0) {\n    const answer = await confirmAsync({\n      message: currentSdk\n        ? `We don't have a compatible client for SDK ${currentSdkVersion}. Do you want to try the latest client?`\n        : \"It looks like we don't have a compatible client. Do you want to try the latest client?\",\n    });\n    if (answer) {\n      await Android.upgradeExpoAsync({\n        device,\n        url: latestClient?.url,\n        version: latestClient?.version,\n      });\n      Log.log('Done!');\n    } else {\n      Log.log('No client to install');\n    }\n    return;\n  }\n\n  const targetClient = await ClientUpgradeUtils.askClientToInstall({\n    currentSdkVersion,\n    latestSdkVersion: latestSdk.version,\n    clients: availableClients,\n  });\n\n  if (await Android.upgradeExpoAsync({ device, url: targetClient.clientUrl })) {\n    Log.log('Done!');\n  }\n}\n"],"mappings":"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"}