{"version":3,"file":"installNodeDependenciesAsync.js","names":["_chalk","data","_interopRequireDefault","require","_fsExtra","_CommandError","_ora","CreateApp","_interopRequireWildcard","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","installNodeDependenciesAsync","projectRoot","packageManager","clean","cleanJsDepsStep","logNewSection","time","Date","now","fs","remove","succeed","chalk","gray","installJsDepsStep","message","bold","fail","red","SilentError"],"sources":["../../../src/commands/eject/installNodeDependenciesAsync.ts"],"sourcesContent":["import chalk from 'chalk';\nimport fs from 'fs-extra';\n\nimport { SilentError } from '../../CommandError';\nimport { logNewSection } from '../../utils/ora';\nimport * as CreateApp from '../utils/CreateApp';\n\n/**\n * Wraps PackageManager to install node modules and adds CLI logs.\n *\n * @param projectRoot\n */\nexport async function installNodeDependenciesAsync(\n  projectRoot: string,\n  packageManager: 'yarn' | 'npm',\n  { clean = true }: { clean: boolean }\n) {\n  if (clean && packageManager !== 'yarn') {\n    // This step can take a couple seconds, if the installation logs are enabled (with EXPO_DEBUG) then it\n    // ends up looking odd to see \"Installing JavaScript dependencies\" for ~5 seconds before the logs start showing up.\n    const cleanJsDepsStep = logNewSection('Cleaning JavaScript dependencies');\n    const time = Date.now();\n    // nuke the node modules\n    // TODO: this is substantially slower, we should find a better alternative to ensuring the modules are installed.\n    await fs.remove('node_modules');\n    cleanJsDepsStep.succeed(\n      `Cleaned JavaScript dependencies ${chalk.gray(Date.now() - time + 'ms')}`\n    );\n  }\n\n  const installJsDepsStep = logNewSection('Installing JavaScript dependencies');\n  try {\n    const time = Date.now();\n    await CreateApp.installNodeDependenciesAsync(projectRoot, packageManager);\n    installJsDepsStep.succeed(\n      `Installed JavaScript dependencies ${chalk.gray(Date.now() - time + 'ms')}`\n    );\n  } catch {\n    const message = `Something went wrong installing JavaScript dependencies, check your ${packageManager} logfile or run ${chalk.bold(\n      `${packageManager} install`\n    )} again manually.`;\n    installJsDepsStep.fail(chalk.red(message));\n    // TODO: actually show the error message from the package manager! :O\n    throw new SilentError(message);\n  }\n}\n"],"mappings":"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"}