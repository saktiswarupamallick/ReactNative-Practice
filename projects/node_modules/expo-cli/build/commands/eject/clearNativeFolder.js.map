{"version":3,"file":"clearNativeFolder.js","names":["_configPlugins","data","require","_chalk","_interopRequireDefault","fs","_interopRequireWildcard","path","_log","_ora","_prompts","_environment","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","directoryExistsAsync","file","_await$fs$stat$catch$","_await$fs$stat$catch","stat","catch","isDirectory","clearNativeFolder","projectRoot","folders","step","logNewSection","join","Promise","all","map","folderName","remove","succeed","error","fail","message","hasRequiredAndroidFilesAsync","AndroidConfig","Paths","getAppBuildGradleAsync","getProjectBuildGradleAsync","getAndroidManifestAsync","getMainApplicationAsync","isAndroidProjectValidAsync","hasRequiredIOSFilesAsync","IOSConfig","getAppDelegate","getAllXcodeProjectPaths","getAllInfoPlistPaths","getAllPBXProjectPaths","isIOSProjectValidAsync","promptToClearMalformedNativeProjectsAsync","checkPlatforms","isAndroidValid","isIOSValid","includes","resolve","platforms","filter","Boolean","displayPlatforms","platform","chalk","cyan","length","isNonInteractive","confirmAsync","initial","Log","warn"],"sources":["../../../src/commands/eject/clearNativeFolder.ts"],"sourcesContent":["import { AndroidConfig, IOSConfig } from '@expo/config-plugins';\nimport chalk from 'chalk';\nimport * as fs from 'fs-extra';\nimport * as path from 'path';\n\nimport Log from '../../log';\nimport { logNewSection } from '../../utils/ora';\nimport { confirmAsync } from '../../utils/prompts';\nimport { isNonInteractive } from '../utils/environment';\n\nexport async function directoryExistsAsync(file: string): Promise<boolean> {\n  return (await fs.stat(file).catch(() => null))?.isDirectory() ?? false;\n}\n\nexport async function clearNativeFolder(projectRoot: string, folders: string[]) {\n  const step = logNewSection(`Clearing ${folders.join(', ')}`);\n  try {\n    await Promise.all(folders.map(folderName => fs.remove(path.join(projectRoot, folderName))));\n    step.succeed(`Cleared ${folders.join(', ')} code`);\n  } catch (error: any) {\n    step.fail(`Failed to delete ${folders.join(', ')} code: ${error.message}`);\n    throw error;\n  }\n}\n\nexport async function hasRequiredAndroidFilesAsync(projectRoot: string) {\n  try {\n    await Promise.all([\n      AndroidConfig.Paths.getAppBuildGradleAsync(projectRoot),\n      AndroidConfig.Paths.getProjectBuildGradleAsync(projectRoot),\n      AndroidConfig.Paths.getAndroidManifestAsync(projectRoot),\n      AndroidConfig.Paths.getMainApplicationAsync(projectRoot),\n    ]);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nasync function isAndroidProjectValidAsync(projectRoot: string) {\n  // Only perform the check if the native folder is present.\n  if (!(await directoryExistsAsync(path.join(projectRoot, 'android')))) {\n    return true;\n  }\n  return hasRequiredAndroidFilesAsync(projectRoot);\n}\n\nexport async function hasRequiredIOSFilesAsync(projectRoot: string) {\n  try {\n    // If any of the following required files are missing, then the project is malformed.\n    await Promise.all([\n      IOSConfig.Paths.getAppDelegate(projectRoot),\n      IOSConfig.Paths.getAllXcodeProjectPaths(projectRoot),\n      IOSConfig.Paths.getAllInfoPlistPaths(projectRoot),\n      IOSConfig.Paths.getAllPBXProjectPaths(projectRoot),\n    ]);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nasync function isIOSProjectValidAsync(projectRoot: string) {\n  // Only perform the check if the native folder is present.\n  if (!(await directoryExistsAsync(path.join(projectRoot, 'ios')))) {\n    return true;\n  }\n  return hasRequiredIOSFilesAsync(projectRoot);\n}\n\nexport async function promptToClearMalformedNativeProjectsAsync(\n  projectRoot: string,\n  checkPlatforms: string[]\n) {\n  const [isAndroidValid, isIOSValid] = await Promise.all([\n    checkPlatforms.includes('android')\n      ? isAndroidProjectValidAsync(projectRoot)\n      : Promise.resolve(true),\n    checkPlatforms.includes('ios') ? isIOSProjectValidAsync(projectRoot) : Promise.resolve(true),\n  ]);\n\n  if (isAndroidValid && isIOSValid) {\n    return;\n  }\n\n  const platforms = [!isAndroidValid && 'android', !isIOSValid && 'ios'].filter(\n    Boolean\n  ) as string[];\n\n  const displayPlatforms = platforms.map(platform => chalk.cyan(platform));\n  // Prompt which platforms to reset.\n  const message =\n    platforms.length > 1\n      ? `The ${displayPlatforms[0]} and ${displayPlatforms[1]} projects are malformed`\n      : `The ${displayPlatforms[0]} project is malformed`;\n\n  if (\n    // If the process is non-interactive, default to clearing the malformed native project.\n    // This would only happen on re-running eject.\n    isNonInteractive() ||\n    // Prompt to clear the native folders.\n    (await confirmAsync({\n      message: `${message}, would you like to clear the project files and reinitialize them?`,\n      initial: true,\n    }))\n  ) {\n    if (isNonInteractive()) {\n      Log.warn(`${message}, project files will be cleared and reinitialized.`);\n    }\n    await clearNativeFolder(projectRoot, platforms);\n  } else {\n    // Warn the user that the process may fail.\n    Log.warn('Continuing with malformed native projects');\n  }\n}\n"],"mappings":";;;;;;;;;;AAAA,SAAAA,eAAA;EAAA,MAAAC,IAAA,GAAAC,OAAA;EAAAF,cAAA,YAAAA,CAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAE,OAAA;EAAA,MAAAF,IAAA,GAAAG,sBAAA,CAAAF,OAAA;EAAAC,MAAA,YAAAA,CAAA;IAAA,OAAAF,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAI,GAAA;EAAA,MAAAJ,IAAA,GAAAK,uBAAA,CAAAJ,OAAA;EAAAG,EAAA,YAAAA,CAAA;IAAA,OAAAJ,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAM,KAAA;EAAA,MAAAN,IAAA,GAAAK,uBAAA,CAAAJ,OAAA;EAAAK,IAAA,YAAAA,CAAA;IAAA,OAAAN,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAEA,SAAAO,KAAA;EAAA,MAAAP,IAAA,GAAAG,sBAAA,CAAAF,OAAA;EAAAM,IAAA,YAAAA,CAAA;IAAA,OAAAP,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAQ,KAAA;EAAA,MAAAR,IAAA,GAAAC,OAAA;EAAAO,IAAA,YAAAA,CAAA;IAAA,OAAAR,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAS,SAAA;EAAA,MAAAT,IAAA,GAAAC,OAAA;EAAAQ,QAAA,YAAAA,CAAA;IAAA,OAAAT,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAU,aAAA;EAAA,MAAAV,IAAA,GAAAC,OAAA;EAAAS,YAAA,YAAAA,CAAA;IAAA,OAAAV,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAAwD,SAAAW,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAP,wBAAAW,GAAA,EAAAJ,WAAA,SAAAA,WAAA,IAAAI,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAG,KAAA,GAAAR,wBAAA,CAAAC,WAAA,OAAAO,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAJ,GAAA,YAAAG,KAAA,CAAAE,GAAA,CAAAL,GAAA,SAAAM,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAX,GAAA,QAAAW,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAd,GAAA,EAAAW,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAV,GAAA,EAAAW,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAX,GAAA,CAAAW,GAAA,SAAAL,MAAA,CAAAJ,OAAA,GAAAF,GAAA,MAAAG,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAAhB,GAAA,EAAAM,MAAA,YAAAA,MAAA;AAAA,SAAAnB,uBAAAa,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAEjD,eAAeiB,oBAAoBA,CAACC,IAAY,EAAoB;EAAA,IAAAC,qBAAA,EAAAC,oBAAA;EACzE,QAAAD,qBAAA,IAAAC,oBAAA,GAAQ,MAAMhC,EAAE,CAAD,CAAC,CAACiC,IAAI,CAACH,IAAI,CAAC,CAACI,KAAK,CAAC,MAAM,IAAI,CAAC,cAAAF,oBAAA,uBAAtCA,oBAAA,CAAyCG,WAAW,CAAC,CAAC,cAAAJ,qBAAA,cAAAA,qBAAA,GAAI,KAAK;AACxE;AAEO,eAAeK,iBAAiBA,CAACC,WAAmB,EAAEC,OAAiB,EAAE;EAC9E,MAAMC,IAAI,GAAG,IAAAC,oBAAa,EAAE,YAAWF,OAAO,CAACG,IAAI,CAAC,IAAI,CAAE,EAAC,CAAC;EAC5D,IAAI;IACF,MAAMC,OAAO,CAACC,GAAG,CAACL,OAAO,CAACM,GAAG,CAACC,UAAU,IAAI7C,EAAE,CAAD,CAAC,CAAC8C,MAAM,CAAC5C,IAAI,CAAD,CAAC,CAACuC,IAAI,CAACJ,WAAW,EAAEQ,UAAU,CAAC,CAAC,CAAC,CAAC;IAC3FN,IAAI,CAACQ,OAAO,CAAE,WAAUT,OAAO,CAACG,IAAI,CAAC,IAAI,CAAE,OAAM,CAAC;EACpD,CAAC,CAAC,OAAOO,KAAU,EAAE;IACnBT,IAAI,CAACU,IAAI,CAAE,oBAAmBX,OAAO,CAACG,IAAI,CAAC,IAAI,CAAE,UAASO,KAAK,CAACE,OAAQ,EAAC,CAAC;IAC1E,MAAMF,KAAK;EACb;AACF;AAEO,eAAeG,4BAA4BA,CAACd,WAAmB,EAAE;EACtE,IAAI;IACF,MAAMK,OAAO,CAACC,GAAG,CAAC,CAChBS,8BAAa,CAACC,KAAK,CAACC,sBAAsB,CAACjB,WAAW,CAAC,EACvDe,8BAAa,CAACC,KAAK,CAACE,0BAA0B,CAAClB,WAAW,CAAC,EAC3De,8BAAa,CAACC,KAAK,CAACG,uBAAuB,CAACnB,WAAW,CAAC,EACxDe,8BAAa,CAACC,KAAK,CAACI,uBAAuB,CAACpB,WAAW,CAAC,CACzD,CAAC;IACF,OAAO,IAAI;EACb,CAAC,CAAC,MAAM;IACN,OAAO,KAAK;EACd;AACF;AAEA,eAAeqB,0BAA0BA,CAACrB,WAAmB,EAAE;EAC7D;EACA,IAAI,EAAE,MAAMR,oBAAoB,CAAC3B,IAAI,CAAD,CAAC,CAACuC,IAAI,CAACJ,WAAW,EAAE,SAAS,CAAC,CAAC,CAAC,EAAE;IACpE,OAAO,IAAI;EACb;EACA,OAAOc,4BAA4B,CAACd,WAAW,CAAC;AAClD;AAEO,eAAesB,wBAAwBA,CAACtB,WAAmB,EAAE;EAClE,IAAI;IACF;IACA,MAAMK,OAAO,CAACC,GAAG,CAAC,CAChBiB,0BAAS,CAACP,KAAK,CAACQ,cAAc,CAACxB,WAAW,CAAC,EAC3CuB,0BAAS,CAACP,KAAK,CAACS,uBAAuB,CAACzB,WAAW,CAAC,EACpDuB,0BAAS,CAACP,KAAK,CAACU,oBAAoB,CAAC1B,WAAW,CAAC,EACjDuB,0BAAS,CAACP,KAAK,CAACW,qBAAqB,CAAC3B,WAAW,CAAC,CACnD,CAAC;IACF,OAAO,IAAI;EACb,CAAC,CAAC,MAAM;IACN,OAAO,KAAK;EACd;AACF;AAEA,eAAe4B,sBAAsBA,CAAC5B,WAAmB,EAAE;EACzD;EACA,IAAI,EAAE,MAAMR,oBAAoB,CAAC3B,IAAI,CAAD,CAAC,CAACuC,IAAI,CAACJ,WAAW,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE;IAChE,OAAO,IAAI;EACb;EACA,OAAOsB,wBAAwB,CAACtB,WAAW,CAAC;AAC9C;AAEO,eAAe6B,yCAAyCA,CAC7D7B,WAAmB,EACnB8B,cAAwB,EACxB;EACA,MAAM,CAACC,cAAc,EAAEC,UAAU,CAAC,GAAG,MAAM3B,OAAO,CAACC,GAAG,CAAC,CACrDwB,cAAc,CAACG,QAAQ,CAAC,SAAS,CAAC,GAC9BZ,0BAA0B,CAACrB,WAAW,CAAC,GACvCK,OAAO,CAAC6B,OAAO,CAAC,IAAI,CAAC,EACzBJ,cAAc,CAACG,QAAQ,CAAC,KAAK,CAAC,GAAGL,sBAAsB,CAAC5B,WAAW,CAAC,GAAGK,OAAO,CAAC6B,OAAO,CAAC,IAAI,CAAC,CAC7F,CAAC;EAEF,IAAIH,cAAc,IAAIC,UAAU,EAAE;IAChC;EACF;EAEA,MAAMG,SAAS,GAAG,CAAC,CAACJ,cAAc,IAAI,SAAS,EAAE,CAACC,UAAU,IAAI,KAAK,CAAC,CAACI,MAAM,CAC3EC,OACF,CAAa;EAEb,MAAMC,gBAAgB,GAAGH,SAAS,CAAC5B,GAAG,CAACgC,QAAQ,IAAIC,gBAAK,CAACC,IAAI,CAACF,QAAQ,CAAC,CAAC;EACxE;EACA,MAAM1B,OAAO,GACXsB,SAAS,CAACO,MAAM,GAAG,CAAC,GACf,OAAMJ,gBAAgB,CAAC,CAAC,CAAE,QAAOA,gBAAgB,CAAC,CAAC,CAAE,yBAAwB,GAC7E,OAAMA,gBAAgB,CAAC,CAAC,CAAE,uBAAsB;EAEvD;EACE;EACA;EACA,IAAAK,+BAAgB,EAAC,CAAC;EAClB;EACC,MAAM,IAAAC,uBAAY,EAAC;IAClB/B,OAAO,EAAG,GAAEA,OAAQ,oEAAmE;IACvFgC,OAAO,EAAE;EACX,CAAC,CAAC,CAAC,EACH;IACA,IAAI,IAAAF,+BAAgB,EAAC,CAAC,EAAE;MACtBG,cAAG,CAACC,IAAI,CAAE,GAAElC,OAAQ,oDAAmD,CAAC;IAC1E;IACA,MAAMd,iBAAiB,CAACC,WAAW,EAAEmC,SAAS,CAAC;EACjD,CAAC,MAAM;IACL;IACAW,cAAG,CAACC,IAAI,CAAC,2CAA2C,CAAC;EACvD;AACF"}