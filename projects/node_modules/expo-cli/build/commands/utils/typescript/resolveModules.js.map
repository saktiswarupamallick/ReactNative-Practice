{"version":3,"file":"resolveModules.js","names":["_fsExtra","data","require","path","_interopRequireWildcard","_resolveFrom","_interopRequireDefault","_glob","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","fileExistsAsync","file","_await$stat$catch$isF","_await$stat$catch","stat","catch","isFile","requiredPackages","pkg","baseTSConfigName","exports","queryFirstProjectTypeScriptFileAsync","projectRoot","_results$","results","wrapGlobWithTimeout","everyMatchAsync","cwd","ignore","resolveBaseTSConfig","_resolveFrom$silent","resolveFrom","silent","hasTSConfig","tsConfigPath","join","collectMissingPackages","resolutions","missingPackages","filter","p","missing"],"sources":["../../../../src/commands/utils/typescript/resolveModules.ts"],"sourcesContent":["import { stat } from 'fs-extra';\nimport * as path from 'path';\nimport resolveFrom from 'resolve-from';\n\nimport { everyMatchAsync, wrapGlobWithTimeout } from '../glob';\n\nasync function fileExistsAsync(file: string): Promise<boolean> {\n  return (await stat(file).catch(() => null))?.isFile() ?? false;\n}\n\nconst requiredPackages = [\n  // use typescript/package.json to skip node module cache issues when the user installs\n  // the package and attempts to resolve the module in the same process.\n  { file: 'typescript/package.json', pkg: 'typescript' },\n  { file: '@types/react/package.json', pkg: '@types/react' },\n  { file: '@types/react-native/package.json', pkg: '@types/react-native' },\n];\n\nexport const baseTSConfigName = 'expo/tsconfig.base';\n\nexport async function queryFirstProjectTypeScriptFileAsync(\n  projectRoot: string\n): Promise<null | string> {\n  const results = await wrapGlobWithTimeout(\n    () =>\n      everyMatchAsync('**/*.@(ts|tsx)', {\n        cwd: projectRoot,\n        ignore: [\n          '**/@(Carthage|Pods|node_modules)/**',\n          '**/*.d.ts',\n          '@(ios|android|web|web-build|dist)/**',\n        ],\n      }),\n    5000\n  );\n\n  if (results === false) {\n    return null;\n  }\n  return results[0] ?? null;\n}\n\nexport function resolveBaseTSConfig(projectRoot: string): string | null {\n  return resolveFrom.silent(projectRoot, 'expo/tsconfig.base.json') ?? null;\n}\n\nexport async function hasTSConfig(projectRoot: string): Promise<string | null> {\n  const tsConfigPath = path.join(projectRoot, 'tsconfig.json');\n  if (await fileExistsAsync(tsConfigPath)) {\n    return tsConfigPath;\n  }\n  return null;\n}\n\nexport function collectMissingPackages(\n  projectRoot: string\n): {\n  missing: {\n    file: string;\n    pkg: string;\n    version?: string;\n  }[];\n  resolutions: Record<string, string>;\n} {\n  const resolutions: Record<string, string> = {};\n\n  const missingPackages = requiredPackages.filter(p => {\n    try {\n      resolutions[p.pkg] = resolveFrom(projectRoot, p.file);\n      return false;\n    } catch {\n      return true;\n    }\n  });\n\n  return { missing: missingPackages, resolutions };\n}\n"],"mappings":"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"}