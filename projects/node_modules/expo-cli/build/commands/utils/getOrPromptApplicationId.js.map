{"version":3,"file":"getOrPromptApplicationId.js","names":["_config","data","require","_chalk","_interopRequireDefault","_xdl","_CommandError","_log","_prompts","_interopRequireWildcard","_TerminalLink","_modifyConfigAsync","_validateApplicationId","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","noBundleIdMessage","noPackageMessage","getOrPromptForBundleIdentifier","projectRoot","_exp$ios","_exp$android","_exp$android2","exp","getConfig","skipSDKVersionRequirement","currentBundleId","ios","bundleIdentifier","validateBundleId","CommandError","recommendedBundleId","android","package","_exp$android3","_exp$owner","username","owner","UserManager","getCurrentUsernameAsync","possibleId","slug","Log","addNewLineIfNone","log","chalk","bold","dim","learnMore","newLine","prompt","type","name","initial","message","validate","nonInteractiveHelp","warning","getBundleIdWarningAsync","nestedWarn","confirmAsync","attemptModification","getOrPromptForPackage","_exp$android4","_exp$ios2","currentPackage","validatePackage","recommendedPackage","_exp$owner2","split","join","packageName","getPackageNameWarningAsync"],"sources":["../../../src/commands/utils/getOrPromptApplicationId.ts"],"sourcesContent":["import { getConfig } from '@expo/config';\nimport chalk from 'chalk';\nimport { UserManager } from 'xdl';\n\nimport CommandError from '../../CommandError';\nimport Log from '../../log';\nimport prompt, { confirmAsync } from '../../utils/prompts';\nimport { learnMore } from './TerminalLink';\nimport { attemptModification } from './modifyConfigAsync';\nimport {\n  getBundleIdWarningAsync,\n  getPackageNameWarningAsync,\n  validateBundleId,\n  validatePackage,\n} from './validateApplicationId';\n\nconst noBundleIdMessage = `Your project must have a \\`bundleIdentifier\\` set in the Expo config (app.json or app.config.js).\\nSee https://expo.fyi/bundle-identifier`;\nconst noPackageMessage = `Your project must have a \\`package\\` set in the Expo config (app.json or app.config.js).\\nSee https://expo.fyi/android-package`;\n\nexport async function getOrPromptForBundleIdentifier(projectRoot: string): Promise<string> {\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n\n  const currentBundleId = exp.ios?.bundleIdentifier;\n  if (currentBundleId) {\n    if (validateBundleId(currentBundleId)) {\n      return currentBundleId;\n    }\n    throw new CommandError(\n      `The ios.bundleIdentifier defined in your Expo config is not formatted properly. Only alphanumeric characters, '.', '-', and '_' are allowed, and each '.' must be followed by a letter.`\n    );\n  }\n\n  // Recommend a bundle ID based on the username and project slug.\n  let recommendedBundleId: string | undefined;\n  // Attempt to use the android package name first since it's convenient to have them aligned.\n  if (exp.android?.package && validateBundleId(exp.android?.package)) {\n    recommendedBundleId = exp.android?.package;\n  } else {\n    const username = exp.owner ?? (await UserManager.getCurrentUsernameAsync());\n    const possibleId = `com.${username}.${exp.slug}`;\n    if (username && validateBundleId(possibleId)) {\n      recommendedBundleId = possibleId;\n    }\n  }\n\n  Log.addNewLineIfNone();\n  Log.log(\n    `${chalk.bold(`üìù  iOS Bundle Identifier`)} ${chalk.dim(\n      learnMore('https://expo.fyi/bundle-identifier')\n    )}`\n  );\n  Log.newLine();\n  // Prompt the user for the bundle ID.\n  // Even if the project is using a dynamic config we can still\n  // prompt a better error message, recommend a default value, and help the user\n  // validate their custom bundle ID upfront.\n  const { bundleIdentifier } = await prompt(\n    {\n      type: 'text',\n      name: 'bundleIdentifier',\n      initial: recommendedBundleId,\n      // The Apple helps people know this isn't an EAS feature.\n      message: `What would you like your iOS bundle identifier to be?`,\n      validate: validateBundleId,\n    },\n    {\n      nonInteractiveHelp: noBundleIdMessage,\n    }\n  );\n\n  // Warn the user if the bundle ID is already in use.\n  const warning = await getBundleIdWarningAsync(bundleIdentifier);\n  if (warning) {\n    Log.newLine();\n    Log.nestedWarn(warning);\n    Log.newLine();\n    if (\n      !(await confirmAsync({\n        message: `Continue?`,\n        initial: true,\n      }))\n    ) {\n      Log.newLine();\n      return getOrPromptForBundleIdentifier(projectRoot);\n    }\n  }\n\n  // Apply the changes to the config.\n  await attemptModification(\n    projectRoot,\n    {\n      ios: { ...(exp.ios || {}), bundleIdentifier },\n    },\n    { ios: { bundleIdentifier } }\n  );\n\n  return bundleIdentifier;\n}\n\nexport async function getOrPromptForPackage(projectRoot: string): Promise<string> {\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n\n  const currentPackage = exp.android?.package;\n  if (currentPackage) {\n    if (validatePackage(currentPackage)) {\n      return currentPackage;\n    }\n    throw new CommandError(\n      `Invalid format of Android package name. Only alphanumeric characters, '.' and '_' are allowed, and each '.' must be followed by a letter.`\n    );\n  }\n\n  // Recommend a package name based on the username and project slug.\n  let recommendedPackage: string | undefined;\n  // Attempt to use the ios bundle id first since it's convenient to have them aligned.\n  if (exp.ios?.bundleIdentifier && validatePackage(exp.ios.bundleIdentifier)) {\n    recommendedPackage = exp.ios.bundleIdentifier;\n  } else {\n    const username = exp.owner ?? (await UserManager.getCurrentUsernameAsync());\n    // It's common to use dashes in your node project name, strip them from the suggested package name.\n    const possibleId = `com.${username}.${exp.slug}`.split('-').join('');\n    if (username && validatePackage(possibleId)) {\n      recommendedPackage = possibleId;\n    }\n  }\n\n  Log.addNewLineIfNone();\n  Log.log(\n    `${chalk.bold(`üìù  Android package`)} ${chalk.dim(\n      learnMore('https://expo.fyi/android-package')\n    )}`\n  );\n  Log.newLine();\n\n  // Prompt the user for the android package.\n  // Even if the project is using a dynamic config we can still\n  // prompt a better error message, recommend a default value, and help the user\n  // validate their custom android package upfront.\n  const { packageName } = await prompt(\n    {\n      type: 'text',\n      name: 'packageName',\n      initial: recommendedPackage,\n      message: `What would you like your Android package name to be?`,\n      validate: validatePackage,\n    },\n    {\n      nonInteractiveHelp: noPackageMessage,\n    }\n  );\n\n  // Warn the user if the package name is already in use.\n  const warning = await getPackageNameWarningAsync(packageName);\n  if (warning) {\n    Log.newLine();\n    Log.nestedWarn(warning);\n    Log.newLine();\n    if (\n      !(await confirmAsync({\n        message: `Continue?`,\n        initial: true,\n      }))\n    ) {\n      Log.newLine();\n      return getOrPromptForPackage(projectRoot);\n    }\n  }\n\n  // Apply the changes to the config.\n  await attemptModification(\n    projectRoot,\n    {\n      android: { ...(exp.android || {}), package: packageName },\n    },\n    {\n      android: { package: packageName },\n    }\n  );\n\n  return packageName;\n}\n"],"mappings":"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"}