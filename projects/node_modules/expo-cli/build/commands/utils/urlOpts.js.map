{"version":3,"file":"urlOpts.js","names":["_qrcodeTerminal","data","_interopRequireDefault","require","_xdl","_CommandError","_interopRequireWildcard","_log","_schemes","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","addOptions","program","option","optsAsync","projectRoot","options","opts","ProjectSettings","readAsync","host","lan","localhost","tunnel","filter","i","length","CommandError","hostType","offline","ConnectionStatus","setIsOffline","scheme","_options$scheme","devClient","getOptionalDevClientSchemeAsync","isDevClientPackageInstalled","setAsync","printQRCode","url","qrcodeTerminal","generate","small","code","Log","log","handleMobileOptsAsync","results","Promise","all","android","webOnly","Android","openWebProjectAsync","_options$devClient","openProjectAsync","ios","Simulator","shouldPrompt","_options$devClient2","web","Webpack","openAsync","errors","reduce","prev","curr","success","concat","error","Boolean","isEscapedError","some","AbortCommandError","_default","exports"],"sources":["../../../src/commands/utils/urlOpts.ts"],"sourcesContent":["import type { Command } from 'commander';\nimport qrcodeTerminal from 'qrcode-terminal';\nimport {\n  Android,\n  ConnectionStatus,\n  isDevClientPackageInstalled,\n  ProjectSettings,\n  Simulator,\n  Webpack,\n} from 'xdl';\n\nimport CommandError, { AbortCommandError } from '../../CommandError';\nimport Log from '../../log';\nimport { getOptionalDevClientSchemeAsync } from '../run/utils/schemes';\n\n// NOTE: if you update this, you should also update assertValidOptions in UrlUtils.ts\nexport type URLOptions = {\n  devClient?: boolean;\n  android?: boolean;\n  ios?: boolean;\n  web?: boolean;\n  scheme?: string;\n  host?: 'lan' | 'tunnel' | 'localhost';\n  tunnel?: boolean;\n  lan?: boolean;\n  localhost?: boolean;\n};\n\nfunction addOptions(program: Command) {\n  program\n    .option(\n      '--dev-client',\n      'Experimental: Starts the bundler for use with the expo-development-client'\n    )\n    .option('--scheme <scheme>', 'Custom URI protocol to use with a development build')\n    .option('-a, --android', 'Opens your app in Expo Go on a connected Android device')\n    .option(\n      '-i, --ios',\n      'Opens your app in Expo Go in a currently running iOS simulator on your computer'\n    )\n    .option('-w, --web', 'Opens your app in a web browser')\n    .option(\n      '-m, --host [mode]',\n      'lan (default), tunnel, localhost. Type of host to use. \"tunnel\" allows you to view your link on other networks'\n    )\n    .option('--tunnel', 'Same as --host tunnel')\n    .option('--lan', 'Same as --host lan')\n    .option('--localhost', 'Same as --host localhost');\n}\n\nasync function optsAsync(projectRoot: string, options: any) {\n  const opts = await ProjectSettings.readAsync(projectRoot);\n\n  if ([options.host, options.lan, options.localhost, options.tunnel].filter(i => i).length > 1) {\n    throw new CommandError(\n      'BAD_ARGS',\n      'Specify at most one of --host, --tunnel, --lan, and --localhost'\n    );\n  }\n\n  opts.hostType = 'lan';\n\n  if (options.offline) {\n    // TODO: maybe let people know that we will force localhost with offline?\n    ConnectionStatus.setIsOffline(true);\n    opts.hostType = 'localhost';\n  }\n\n  if (options.host) {\n    opts.hostType = options.host;\n  } else if (options.tunnel) {\n    opts.hostType = 'tunnel';\n  } else if (options.lan) {\n    opts.hostType = 'lan';\n  } else if (options.localhost) {\n    opts.hostType = 'localhost';\n  }\n\n  if (typeof options.scheme === 'string') {\n    // Use the custom scheme\n    opts.scheme = options.scheme ?? null;\n  } else if (options.devClient) {\n    // Attempt to find the scheme or warn the user how to setup a custom scheme\n    opts.scheme = await getOptionalDevClientSchemeAsync(projectRoot);\n  } else if (!options.devClient && isDevClientPackageInstalled(projectRoot)) {\n    opts.scheme = await getOptionalDevClientSchemeAsync(projectRoot);\n  } else {\n    // Ensure this is reset when users don't use `--scheme`, `--dev-client` and don't have the `expo-dev-client` package installed.\n    opts.scheme = null;\n  }\n\n  await ProjectSettings.setAsync(projectRoot, opts);\n\n  return opts;\n}\n\nfunction printQRCode(url: string) {\n  qrcodeTerminal.generate(url, { small: true }, code => Log.log(code));\n}\n\nasync function handleMobileOptsAsync(\n  projectRoot: string,\n  options: Pick<URLOptions, 'devClient' | 'ios' | 'android' | 'web'> & { webOnly?: boolean }\n) {\n  const results = await Promise.all([\n    (async () => {\n      if (options.android) {\n        if (options.webOnly) {\n          return await Android.openWebProjectAsync({ projectRoot });\n        } else {\n          return await Android.openProjectAsync({\n            projectRoot,\n            devClient: options.devClient ?? false,\n          });\n        }\n      }\n      return null;\n    })(),\n    (async () => {\n      if (options.ios) {\n        if (options.webOnly) {\n          return await Simulator.openWebProjectAsync({ projectRoot, shouldPrompt: false });\n        } else {\n          return await Simulator.openProjectAsync({\n            projectRoot,\n            devClient: options.devClient ?? false,\n            shouldPrompt: false,\n          });\n        }\n      }\n      return null;\n    })(),\n    (async () => {\n      if (options.web) {\n        return await Webpack.openAsync(projectRoot);\n      }\n      return null;\n    })(),\n  ]);\n\n  const errors = results\n    .reduce<(string | Error)[]>((prev, curr) => {\n      if (curr && !curr.success) {\n        return prev.concat([curr.error]);\n      }\n      return prev;\n    }, [])\n    .filter(Boolean);\n\n  if (errors.length) {\n    // ctrl+c\n    const isEscapedError = errors.some(error => error === 'escaped');\n    if (isEscapedError) {\n      throw new AbortCommandError();\n    } else {\n      if (typeof errors[0] === 'string') {\n        // Throw the first error\n        throw new CommandError(errors[0]);\n      }\n      throw errors[0];\n    }\n  }\n\n  return !!options.android || !!options.ios;\n}\n\nexport default {\n  addOptions,\n  handleMobileOptsAsync,\n  printQRCode,\n  optsAsync,\n};\n"],"mappings":"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"}