{"version":3,"file":"doctorAsync.js","names":["_config","data","require","_chalk","_interopRequireDefault","_xdl","_log","_getRemoteVersionsForSdk","_profileMethod","_validateDependenciesVersions","_explain","_windows","obj","__esModule","default","validateSupportPackagesAsync","sdkVersion","versionsForSdk","getRemoteVersionsForSdk","supportPackagesToValidate","allPackagesValid","pkg","version","isVersionValid","warnAboutDeepDependenciesAsync","name","validateIllegalPackagesAsync","illegalPackages","allPackagesLegal","isPackageAbsent","actionAsync","projectRoot","options","warnUponCmdExe","exp","profileMethod","getConfig","Versions","gteSdkVersion","Log","error","process","exitCode","foundSomeIssues","validateDependenciesVersionsAsync","fixDependencies","Doctor","validateExpoServersAsync","validateWithNetworkAsync","NO_ISSUES","log","chalk","green"],"sources":["../../../../src/commands/info/doctor/doctorAsync.ts"],"sourcesContent":["import { getConfig } from '@expo/config';\nimport chalk from 'chalk';\nimport { Doctor, Versions } from 'xdl';\n\nimport Log from '../../../log';\nimport { getRemoteVersionsForSdk } from '../../../utils/getRemoteVersionsForSdk';\nimport { profileMethod } from '../../utils/profileMethod';\nimport { validateDependenciesVersionsAsync } from '../../utils/validateDependenciesVersions';\nimport { warnAboutDeepDependenciesAsync } from './depedencies/explain';\nimport { warnUponCmdExe } from './windows';\n\ntype Options = {\n  fixDependencies?: boolean;\n};\n\nasync function validateSupportPackagesAsync(sdkVersion: string): Promise<boolean> {\n  const versionsForSdk = await getRemoteVersionsForSdk(sdkVersion);\n\n  const supportPackagesToValidate = [\n    'expo-modules-autolinking',\n    '@expo/config-plugins',\n    '@expo/prebuild-config',\n  ];\n\n  let allPackagesValid = true;\n  for (const pkg of supportPackagesToValidate) {\n    const version = versionsForSdk[pkg];\n    if (version) {\n      const isVersionValid = await warnAboutDeepDependenciesAsync({ name: pkg, version });\n      if (!isVersionValid) {\n        allPackagesValid = false;\n      }\n    }\n  }\n  return allPackagesValid;\n}\n\n// Ensures that a set of packages\nasync function validateIllegalPackagesAsync(): Promise<boolean> {\n  const illegalPackages = [\n    '@unimodules/core',\n    '@unimodules/react-native-adapter',\n    'react-native-unimodules',\n  ];\n\n  let allPackagesLegal = true;\n\n  for (const pkg of illegalPackages) {\n    const isPackageAbsent = await warnAboutDeepDependenciesAsync({ name: pkg });\n    if (!isPackageAbsent) {\n      allPackagesLegal = false;\n    }\n  }\n\n  return allPackagesLegal;\n}\n\nexport async function actionAsync(projectRoot: string, options: Options) {\n  await warnUponCmdExe();\n\n  const { exp, pkg } = profileMethod(getConfig)(projectRoot);\n\n  if (Versions.gteSdkVersion(exp, '46.0.0')) {\n    Log.error(\n      `'expo-cli doctor' is not supported for SDK 46 and higher. Use 'npx expo-doctor' instead.`\n    );\n    process.exitCode = 1;\n    return;\n  }\n\n  let foundSomeIssues = false;\n\n  // Only use the new validation on SDK +45.\n  if (Versions.gteSdkVersion(exp, '45.0.0')) {\n    if (!(await validateSupportPackagesAsync(exp.sdkVersion!))) {\n      foundSomeIssues = true;\n    }\n  }\n\n  if (Versions.gteSdkVersion(exp, '44.0.0')) {\n    if (!(await validateIllegalPackagesAsync())) {\n      foundSomeIssues = true;\n    }\n  }\n\n  if (\n    !(await profileMethod(validateDependenciesVersionsAsync)(\n      projectRoot,\n      exp,\n      pkg,\n      options.fixDependencies\n    ))\n  ) {\n    foundSomeIssues = true;\n  }\n\n  // note: this currently only warns when something isn't right, it doesn't fail\n  await Doctor.validateExpoServersAsync(projectRoot);\n\n  if ((await Doctor.validateWithNetworkAsync(projectRoot)) !== Doctor.NO_ISSUES) {\n    foundSomeIssues = true;\n  }\n\n  if (foundSomeIssues) {\n    process.exitCode = 1;\n  } else {\n    Log.log(chalk.green(`ðŸŽ‰ Didn't find any issues with the project!`));\n  }\n}\n"],"mappings":"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"}