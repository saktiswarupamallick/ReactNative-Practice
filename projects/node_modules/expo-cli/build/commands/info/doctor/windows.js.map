{"version":3,"file":"windows.js","names":["_chalk","data","require","_child_process","_util","execFileAsync","promisify","execFile","warnUponCmdExe","process","platform","stdout","stderr","ppid","windowsHide","startsWith","parentProcessName","match","toLowerCase","includes","console","warn","yellow"],"sources":["../../../../src/commands/info/doctor/windows.ts"],"sourcesContent":["import { yellow } from 'chalk';\nimport { execFile } from 'child_process';\nimport { promisify } from 'util';\n\n// I deliberately use `execFile` instead of `spawn`, because I expect the output of known format always.\nconst execFileAsync = promisify(execFile);\n\n/**\n * Windows only. On any other platform (including WSL on Windows) it's no-op.\n *\n * Checks whether the script is executed from `cmd.exe` and if positive suggests using other terminals.\n */\nexport async function warnUponCmdExe() {\n  if (process.platform !== 'win32') {\n    return;\n  }\n\n  // we're on Windows & we want to suggest using PowerShell instead of CMD\n  await (async () => {\n    // https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/tasklist\n    const { stdout, stderr } = await execFileAsync(\n      'tasklist',\n      ['/nh', '/fo', 'csv', '/fi', `PID eq ${process.ppid}`],\n      { windowsHide: true }\n    );\n    if (!stdout.startsWith('') || stderr !== '') {\n      // Message upon no command output or wrong input is printed without '\"\" and results are printed with them.\n      // console.log(stdout);\n      // console.log(stderr);\n      return;\n    }\n\n    const [parentProcessName] = stdout.match(/(?<=^\").*?(?=\",)/) || [''];\n    if (parentProcessName.toLowerCase().includes('cmd.exe')) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        yellow(\n          'WARNING: We recommend using PowerShell or Bash via WSL 2 for development with expo-cli on Windows. You may encounter issues using cmd.exe.\\n'\n        )\n      );\n    }\n  })();\n}\n"],"mappings":";;;;;;AAAA,SAAAA,OAAA;EAAA,MAAAC,IAAA,GAAAC,OAAA;EAAAF,MAAA,YAAAA,CAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAE,eAAA;EAAA,MAAAF,IAAA,GAAAC,OAAA;EAAAC,cAAA,YAAAA,CAAA;IAAA,OAAAF,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAG,MAAA;EAAA,MAAAH,IAAA,GAAAC,OAAA;EAAAE,KAAA,YAAAA,CAAA;IAAA,OAAAH,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAEA;AACA,MAAMI,aAAa,GAAG,IAAAC,iBAAS,EAACC,yBAAQ,CAAC;;AAEzC;AACA;AACA;AACA;AACA;AACO,eAAeC,cAAcA,CAAA,EAAG;EACrC,IAAIC,OAAO,CAACC,QAAQ,KAAK,OAAO,EAAE;IAChC;EACF;;EAEA;EACA,MAAM,CAAC,YAAY;IACjB;IACA,MAAM;MAAEC,MAAM;MAAEC;IAAO,CAAC,GAAG,MAAMP,aAAa,CAC5C,UAAU,EACV,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAG,UAASI,OAAO,CAACI,IAAK,EAAC,CAAC,EACtD;MAAEC,WAAW,EAAE;IAAK,CACtB,CAAC;IACD,IAAI,CAACH,MAAM,CAACI,UAAU,CAAC,EAAE,CAAC,IAAIH,MAAM,KAAK,EAAE,EAAE;MAC3C;MACA;MACA;MACA;IACF;IAEA,MAAM,CAACI,iBAAiB,CAAC,GAAGL,MAAM,CAACM,KAAK,CAAC,kBAAkB,CAAC,IAAI,CAAC,EAAE,CAAC;IACpE,IAAID,iBAAiB,CAACE,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAC,SAAS,CAAC,EAAE;MACvD;MACAC,OAAO,CAACC,IAAI,CACV,IAAAC,eAAM,EACJ,8IACF,CACF,CAAC;IACH;EACF,CAAC,EAAE,CAAC;AACN"}