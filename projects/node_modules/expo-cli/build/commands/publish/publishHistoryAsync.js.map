{"version":3,"file":"publishHistoryAsync.js","names":["_dateformat","data","_interopRequireDefault","require","_log","_PublishUtils","table","_interopRequireWildcard","_deprecationNotice","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","HORIZ_CELL_WIDTH_SMALL","HORIZ_CELL_WIDTH_MEDIUM","HORIZ_CELL_WIDTH_BIG","actionAsync","projectRoot","options","printDeprecationNotice","result","getPublishHistoryAsync","raw","Log","log","JSON","stringify","queryResult","length","sampleItem","generalTableString","printTableJson","fullName","hasRuntimeVersion","some","publication","runtimeVersion","hasSdkVersion","sdkVersion","headers","colWidths","bigCells","Set","mediumCells","forEach","header","push","resultRows","map","publishedTime","dateFormat","tableString","printTableJsonArray","Error"],"sources":["../../../src/commands/publish/publishHistoryAsync.ts"],"sourcesContent":["import dateFormat from 'dateformat';\n\nimport Log from '../../log';\nimport { getPublishHistoryAsync, HistoryOptions, Publication } from '../utils/PublishUtils';\nimport * as table from '../utils/cli-table';\nimport { printDeprecationNotice } from './deprecationNotice';\n\nconst HORIZ_CELL_WIDTH_SMALL = 15;\nconst HORIZ_CELL_WIDTH_MEDIUM = 20;\nconst HORIZ_CELL_WIDTH_BIG = 40;\n\nexport async function actionAsync(projectRoot: string, options: HistoryOptions) {\n  printDeprecationNotice();\n  const result = await getPublishHistoryAsync(projectRoot, options);\n\n  if (options.raw) {\n    Log.log(JSON.stringify(result));\n    return;\n  }\n\n  if (result.queryResult && result.queryResult.length > 0) {\n    // Print general publication info\n    const sampleItem = result.queryResult[0]; // get a sample item\n    const generalTableString = table.printTableJson(\n      {\n        fullName: sampleItem.fullName,\n      },\n      'General Info'\n    );\n    Log.log(generalTableString);\n\n    const hasRuntimeVersion = result.queryResult.some(\n      (publication: Publication) => !!publication.runtimeVersion\n    );\n    const hasSdkVersion = result.queryResult.some(\n      (publication: Publication) => !!publication.sdkVersion\n    );\n\n    // Print info specific to each publication\n    const headers = [\n      'publishedTime',\n      'appVersion',\n      ...(hasSdkVersion ? ['sdkVersion'] : []),\n      ...(hasRuntimeVersion ? ['runtimeVersion'] : []),\n      'platform',\n      'channel',\n      'publicationId',\n    ];\n\n    // colWidths contains the cell size of each header\n    const colWidths: number[] = [];\n    const bigCells = new Set(['publicationId', 'publishedTime', 'channel']);\n    const mediumCells = new Set(['runtimeVersion']);\n    headers.forEach(header => {\n      if (bigCells.has(header)) {\n        colWidths.push(HORIZ_CELL_WIDTH_BIG);\n      } else if (mediumCells.has(header)) {\n        colWidths.push(HORIZ_CELL_WIDTH_MEDIUM);\n      } else {\n        colWidths.push(HORIZ_CELL_WIDTH_SMALL);\n      }\n    });\n    const resultRows: Publication[] = result.queryResult.map((publication: Publication) => ({\n      ...publication,\n      publishedTime: dateFormat(publication.publishedTime, 'ddd mmm dd yyyy HH:MM:ss Z'),\n    }));\n    const tableString = table.printTableJsonArray(headers, resultRows, colWidths);\n    Log.log(tableString);\n  } else {\n    throw new Error('No records found matching your query.');\n  }\n}\n"],"mappings":"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"}