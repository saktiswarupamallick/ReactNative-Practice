{"version":3,"file":"fetchAndroidUploadCertAsync.js","names":["fs","data","_interopRequireWildcard","require","path","_xdl","_credentials","_route","_AndroidKeystore","_log","_interopRequireDefault","_utils","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","actionAsync","projectRoot","options","_options$parent","ctx","Context","init","nonInteractive","parent","keystorePath","resolve","manifest","slug","uploadKeyFilename","maybeRenameExistingFileAsync","uploadKeyPath","assertSlug","experienceName","projectOwner","view","DownloadKeystore","outputPath","quiet","runCredentialsManager","keystore","android","fetchKeystore","Log","log","AndroidCredentials","exportCertBase64","keystorePassword","keyAlias","warn","remove"],"sources":["../../../src/commands/fetch/fetchAndroidUploadCertAsync.ts"],"sourcesContent":["import * as fs from 'fs-extra';\nimport * as path from 'path';\nimport { AndroidCredentials } from 'xdl';\n\nimport { Context } from '../../credentials';\nimport { runCredentialsManager } from '../../credentials/route';\nimport { DownloadKeystore } from '../../credentials/views/AndroidKeystore';\nimport Log from '../../log';\nimport { assertSlug, maybeRenameExistingFileAsync, Options } from './utils';\n\nexport async function actionAsync(projectRoot: string, options: Options): Promise<void> {\n  const ctx = new Context();\n  await ctx.init(projectRoot, {\n    nonInteractive: options.parent?.nonInteractive,\n  });\n\n  const keystorePath = path.resolve(projectRoot, `${ctx.manifest.slug}.tmp.jks`);\n\n  const uploadKeyFilename = `${ctx.manifest.slug}_upload_cert.pem`;\n  await maybeRenameExistingFileAsync(projectRoot, uploadKeyFilename);\n  const uploadKeyPath = path.resolve(projectRoot, uploadKeyFilename);\n\n  try {\n    assertSlug(ctx.manifest.slug);\n    const experienceName = `@${ctx.projectOwner}/${ctx.manifest.slug}`;\n    const view = new DownloadKeystore(experienceName, {\n      outputPath: keystorePath,\n      quiet: true,\n    });\n    await runCredentialsManager(ctx, view);\n    const keystore = await ctx.android.fetchKeystore(experienceName);\n\n    if (keystore) {\n      Log.log(`Writing upload key to ${uploadKeyPath}`);\n      await AndroidCredentials.exportCertBase64(\n        {\n          keystorePath,\n          keystorePassword: keystore.keystorePassword,\n          keyAlias: keystore.keyAlias,\n        },\n        uploadKeyPath\n      );\n    } else {\n      Log.warn('There is no valid Keystore defined for this app');\n    }\n  } finally {\n    await fs.remove(keystorePath);\n  }\n}\n"],"mappings":"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"}