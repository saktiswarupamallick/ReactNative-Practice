{"version":3,"file":"getLatestReleaseAsync.js","names":["_config","data","require","_xdl","getLatestReleaseAsync","projectRoot","options","user","UserManager","ensureLoggedInAsync","api","ApiV2","clientForUser","exp","getConfig","skipSDKVersionRequirement","result","postAsync","owner","slug","releaseChannel","count","platform","queryResult","length"],"sources":["../../../src/commands/build/getLatestReleaseAsync.ts"],"sourcesContent":["import { getConfig } from '@expo/config';\nimport { ApiV2, UserManager } from 'xdl';\n\ntype Release = {\n  fullName: string;\n  channel: string;\n  channelId: string;\n  publicationId: string;\n  appVersion: string;\n  sdkVersion: string;\n  publishedTime: string;\n  platform: string;\n};\n\nexport async function getLatestReleaseAsync(\n  projectRoot: string,\n  options: {\n    releaseChannel: string;\n    platform: string;\n    owner?: string;\n  }\n): Promise<Release | null> {\n  const user = await UserManager.ensureLoggedInAsync();\n  const api = ApiV2.clientForUser(user);\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n  const result = await api.postAsync('publish/history', {\n    owner: options.owner,\n    slug: exp.slug,\n    releaseChannel: options.releaseChannel,\n    count: 1,\n    platform: options.platform,\n  });\n  const { queryResult } = result;\n  if (queryResult && queryResult.length > 0) {\n    return queryResult[0];\n  } else {\n    return null;\n  }\n}\n"],"mappings":";;;;;;AAAA,SAAAA,QAAA;EAAA,MAAAC,IAAA,GAAAC,OAAA;EAAAF,OAAA,YAAAA,CAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAE,KAAA;EAAA,MAAAF,IAAA,GAAAC,OAAA;EAAAC,IAAA,YAAAA,CAAA;IAAA,OAAAF,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAaO,eAAeG,qBAAqBA,CACzCC,WAAmB,EACnBC,OAIC,EACwB;EACzB,MAAMC,IAAI,GAAG,MAAMC,kBAAW,CAACC,mBAAmB,CAAC,CAAC;EACpD,MAAMC,GAAG,GAAGC,YAAK,CAACC,aAAa,CAACL,IAAI,CAAC;EACrC,MAAM;IAAEM;EAAI,CAAC,GAAG,IAAAC,mBAAS,EAACT,WAAW,EAAE;IAAEU,yBAAyB,EAAE;EAAK,CAAC,CAAC;EAC3E,MAAMC,MAAM,GAAG,MAAMN,GAAG,CAACO,SAAS,CAAC,iBAAiB,EAAE;IACpDC,KAAK,EAAEZ,OAAO,CAACY,KAAK;IACpBC,IAAI,EAAEN,GAAG,CAACM,IAAI;IACdC,cAAc,EAAEd,OAAO,CAACc,cAAc;IACtCC,KAAK,EAAE,CAAC;IACRC,QAAQ,EAAEhB,OAAO,CAACgB;EACpB,CAAC,CAAC;EACF,MAAM;IAAEC;EAAY,CAAC,GAAGP,MAAM;EAC9B,IAAIO,WAAW,IAAIA,WAAW,CAACC,MAAM,GAAG,CAAC,EAAE;IACzC,OAAOD,WAAW,CAAC,CAAC,CAAC;EACvB,CAAC,MAAM;IACL,OAAO,IAAI;EACb;AACF"}