{"version":3,"file":"route.js","names":["_promise","data","require","_log","_interopRequireDefault","_Select","obj","__esModule","default","_defineProperty","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","runCredentialsManagerStandalone","ctx","startView","manager","CredentialsManager","AskQuit","run","runCredentialsManager","DoQuit","constructor","quit","_manager","_ctx","_mainView","_currentView","_quit","get","Error","open","runAsync","error","QuitError","Log","log","sleep","changeMainView","view","exports"],"sources":["../../src/credentials/route.ts"],"sourcesContent":["import { sleep } from '../commands/utils/promise';\nimport Log from '../log';\nimport { Context, IView } from './context';\nimport { AskQuit, DoQuit, IQuit, QuitError } from './views/Select';\n\nexport async function runCredentialsManagerStandalone(ctx: Context, startView: IView) {\n  const manager = new CredentialsManager(ctx, startView, new AskQuit());\n  await manager.run();\n}\n\nexport async function runCredentialsManager(ctx: Context, startView: IView): Promise<null> {\n  const manager = new CredentialsManager(ctx, startView, new DoQuit());\n  return await manager.run();\n}\n\nexport class CredentialsManager {\n  static _manager?: CredentialsManager;\n  _ctx: Context;\n  _mainView: IView;\n  _currentView: IView;\n  _quit: IQuit;\n\n  constructor(ctx: Context, startView: IView, quit: IQuit) {\n    CredentialsManager._manager = this;\n    this._ctx = ctx;\n    this._mainView = startView;\n    this._currentView = startView;\n    this._quit = quit;\n  }\n\n  static get(): CredentialsManager {\n    if (!CredentialsManager._manager) {\n      throw new Error('Credential Manager has not been initialized yet');\n    }\n    return CredentialsManager._manager;\n  }\n\n  async run(): Promise<null> {\n    while (true) {\n      try {\n        this._currentView =\n          (await this._currentView.open(this._ctx)) || (await this._quit.runAsync(this._mainView));\n      } catch (error: any) {\n        // View quit normally, exit normally\n        if (error instanceof QuitError) {\n          return null;\n        }\n\n        // View encountered error\n        if (this._quit instanceof DoQuit) {\n          // propagate error up\n          throw error;\n        } else {\n          // fallback to interactive Quit View\n          Log.log(error);\n          await sleep(1000);\n          this._currentView = await this._quit.runAsync(this._mainView);\n        }\n      }\n    }\n  }\n\n  changeMainView(view: IView) {\n    this._mainView = view;\n  }\n}\n"],"mappings":"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"}