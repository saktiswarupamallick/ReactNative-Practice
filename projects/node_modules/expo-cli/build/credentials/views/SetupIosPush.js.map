{"version":3,"file":"SetupIosPush.js","names":["_CommandError","data","_interopRequireDefault","require","_log","_prompts","iosPushView","_interopRequireWildcard","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","SetupIosPush","constructor","app","open","ctx","_appCredentials$crede","_appCredentials$crede2","_appCredentials$crede3","user","Error","appCredentials","ios","getAppCredentials","deprecatedPushId","credentials","pushId","deprecatedPushP12","pushP12","deprecatedPushPassword","pushPassword","nonInteractive","CommandError","confirm","confirmAsync","message","Log","log","configuredPushKey","getPushKey","isValid","validatePushKey","CreateOrReusePushKey","exports"],"sources":["../../../src/credentials/views/SetupIosPush.ts"],"sourcesContent":["import CommandError from '../../CommandError';\nimport Log from '../../log';\nimport { confirmAsync } from '../../utils/prompts';\nimport { AppLookupParams } from '../api/IosApi';\nimport { Context, IView } from '../context';\nimport * as iosPushView from './IosPushCredentials';\n\nexport class SetupIosPush implements IView {\n  constructor(private app: AppLookupParams) {}\n\n  async open(ctx: Context): Promise<IView | null> {\n    if (!ctx.user) {\n      throw new Error(`This workflow requires you to be logged in.`);\n    }\n\n    // TODO: Remove this on Nov 2020 when Apple no longer accepts deprecated push certs\n    const appCredentials = await ctx.ios.getAppCredentials(this.app);\n    const deprecatedPushId = appCredentials?.credentials?.pushId;\n    const deprecatedPushP12 = appCredentials?.credentials?.pushP12;\n    const deprecatedPushPassword = appCredentials?.credentials?.pushPassword;\n    if (deprecatedPushId && deprecatedPushP12 && deprecatedPushPassword) {\n      if (ctx.nonInteractive) {\n        throw new CommandError(\n          'NON_INTERACTIVE',\n          \"We've detected legacy Push Certificates on file. Start the CLI without the '--non-interactive' flag to upgrade to the newer standard.\"\n        );\n      }\n\n      const confirm = await confirmAsync({\n        message: `We've detected legacy Push Certificates on file. Would you like to upgrade to the newer standard?`,\n      });\n      if (!confirm) {\n        Log.log(`Using Deprecated Push Cert: ${deprecatedPushId} on file`);\n        return null;\n      }\n    }\n\n    const configuredPushKey = await ctx.ios.getPushKey(this.app);\n\n    if (configuredPushKey) {\n      // we dont need to setup if we have a valid push key on file\n      const isValid = await iosPushView.validatePushKey(ctx, configuredPushKey);\n      if (isValid) {\n        return null;\n      }\n    }\n\n    return new iosPushView.CreateOrReusePushKey(this.app);\n  }\n}\n"],"mappings":"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"}