{"version":3,"file":"process.js","names":["cp","data","_interopRequireWildcard","require","_debug","_interopRequireDefault","util","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","debug","Debug","once","fn","called","r","wrapper","args","exec","promisify","exports","execFile","wait","setTimeout","exitQueue","onBeforeExit","push","BEFORE_EXIT_SIGNALS","beforeExitHandlerWrapper","signal","length","i","entries","e","process","exitCode","exit","on"],"sources":["../../../../src/apple/native-run/utils/process.ts"],"sourcesContent":["/**\n * Copyright (c) 2021 Expo, Inc.\n * Copyright (c) 2018 Drifty Co.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport * as cp from 'child_process';\nimport Debug from 'debug';\nimport * as util from 'util';\n\nconst debug = Debug('expo:xdl:utils:process');\n\nexport function once<T extends (...args: any[]) => any>(fn: T): T {\n  let called = false;\n  let r: any;\n\n  const wrapper: any = (...args: any[]): any => {\n    if (!called) {\n      called = true;\n      r = fn(...args);\n    }\n\n    return r;\n  };\n\n  return wrapper;\n}\nexport const exec = util.promisify(cp.exec);\nexport const execFile = util.promisify(cp.execFile);\nexport const wait = util.promisify(setTimeout);\n\nexport type ExitQueueFn = () => Promise<void>;\n\nconst exitQueue: ExitQueueFn[] = [];\n\nexport function onBeforeExit(fn: ExitQueueFn): void {\n  exitQueue.push(fn);\n}\n\nconst BEFORE_EXIT_SIGNALS: NodeJS.Signals[] = ['SIGINT', 'SIGTERM', 'SIGHUP', 'SIGBREAK'];\n\nconst beforeExitHandlerWrapper = (signal: NodeJS.Signals) =>\n  once(async () => {\n    debug('onBeforeExit handler: %s received', signal);\n    debug('onBeforeExit handler: running %s queued functions', exitQueue.length);\n\n    for (const [i, fn] of exitQueue.entries()) {\n      try {\n        await fn();\n      } catch (e: any) {\n        debug('Error from function %d in exit queue: %O', i, e);\n      }\n    }\n\n    debug('onBeforeExit handler: exiting (exit code %s)', process.exitCode ? process.exitCode : 0);\n\n    process.exit();\n  });\n\nfor (const signal of BEFORE_EXIT_SIGNALS) {\n  process.on(signal, beforeExitHandlerWrapper(signal));\n}\n"],"mappings":"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"}