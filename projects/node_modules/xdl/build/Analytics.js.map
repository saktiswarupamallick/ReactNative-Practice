{"version":3,"file":"Analytics.js","names":["_rudderSdkNode","data","_interopRequireDefault","require","_os","_url","obj","__esModule","default","_defineProperty","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","PLATFORM_TO_ANALYTICS_PLATFORM","darwin","win32","linux","AnalyticsClient","constructor","userId","_userId","version","_version","flush","rudderstackClient","initializeClient","rudderstackWriteKey","rudderstackDataPlaneURL","packageVersion","RudderAnalytics","URL","toString","flushInterval","identifyUser","traits","userTraits","identify","context","getContext","logEvent","name","properties","track","event","platform","os","device","model","brand","release","app","exports","defaultClient","_default"],"sources":["../src/Analytics.ts"],"sourcesContent":["import RudderAnalytics from '@expo/rudder-sdk-node';\nimport os from 'os';\nimport { URL } from 'url';\n\nconst PLATFORM_TO_ANALYTICS_PLATFORM: { [platform: string]: string } = {\n  darwin: 'Mac',\n  win32: 'Windows',\n  linux: 'Linux',\n};\n\nexport class AnalyticsClient {\n  private userTraits?: { [key: string]: any };\n  private rudderstackClient?: RudderAnalytics;\n  private _userId?: string;\n  private _version?: string;\n\n  public get userId() {\n    return this._userId;\n  }\n\n  public get version() {\n    return this._version;\n  }\n\n  public async flush() {\n    if (this.rudderstackClient) {\n      await this.rudderstackClient.flush();\n    }\n  }\n\n  public initializeClient(\n    rudderstackWriteKey: string,\n    rudderstackDataPlaneURL: string,\n    packageVersion: string\n  ) {\n    // Do not wait before flushing, we want node to close immediately if the programs ends\n    this.rudderstackClient = new RudderAnalytics(\n      rudderstackWriteKey,\n      new URL('/v1/batch', rudderstackDataPlaneURL).toString(),\n      {\n        flushInterval: 300,\n      }\n    );\n    this._version = packageVersion;\n  }\n\n  public identifyUser(userId: string, traits: { [key: string]: any }) {\n    this._userId = userId;\n    this.userTraits = traits;\n\n    if (this.rudderstackClient) {\n      this.rudderstackClient.identify({\n        userId: this._userId,\n        traits: this.userTraits,\n        context: this.getContext(),\n      });\n    }\n  }\n\n  public logEvent(name: string, properties: any = {}) {\n    if (this.rudderstackClient && this._userId) {\n      this.rudderstackClient.track({\n        userId: this._userId,\n        event: name,\n        properties,\n        context: this.getContext(),\n      });\n    }\n  }\n\n  private getContext(): any {\n    const platform = PLATFORM_TO_ANALYTICS_PLATFORM[os.platform()] || os.platform();\n    const context = {\n      device: {\n        model: platform,\n        brand: platform,\n      },\n      os: {\n        name: platform,\n        version: os.release(),\n      },\n      app: {},\n    };\n\n    if (this._version) {\n      context.app = {\n        version: this._version,\n      };\n    }\n\n    return context;\n  }\n}\n\nconst defaultClient = new AnalyticsClient();\n\nexport default defaultClient;\n"],"mappings":"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"}