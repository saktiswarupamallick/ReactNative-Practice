{"version":3,"file":"UserSettings.js","names":["_jsonFile","data","_interopRequireDefault","require","_fsExtra","_os","_path","_uuid","_internal","obj","__esModule","default","SETTINGS_FILE_NAME","userSettingsFile","path","join","dotExpoHomeDirectory","userSettingsJsonFile","JsonFile","jsonParseErrorDefault","cantReadFileDefault","mkdirped","dirPath","process","env","__UNSAFE_EXPO_HOME_DIRECTORY","home","os","homedir","Env","isStaging","isLocal","fs","mkdirpSync","getAnonymousIdentifierAsync","settings","id","getAsync","uuidv4","setAsync","accessToken","EXPO_TOKEN","UserSettings","Object","assign","_default","exports"],"sources":["../src/UserSettings.ts"],"sourcesContent":["import JsonFile from '@expo/json-file';\nimport fs from 'fs-extra';\nimport os from 'os';\nimport path from 'path';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { ConnectionType, Env } from './internal';\n\nexport type UserSettingsData = {\n  developmentCodeSigningId?: string;\n  appleId?: string;\n  accessToken?: string;\n  auth?: UserData | null;\n  ignoreBundledBinaries?: string[];\n  openDevToolsAtStartup?: boolean;\n  PATH?: string;\n  sendTo?: string;\n  uuid?: string;\n};\n\nexport type UserData = {\n  developmentCodeSigningId?: string;\n  appleId?: string;\n  userId?: string;\n  username?: string;\n  currentConnection?: ConnectionType;\n  sessionSecret?: string;\n};\n\nconst SETTINGS_FILE_NAME = 'state.json';\n\nfunction userSettingsFile(): string {\n  return path.join(dotExpoHomeDirectory(), SETTINGS_FILE_NAME);\n}\n\nfunction userSettingsJsonFile(): JsonFile<UserSettingsData> {\n  return new JsonFile<UserSettingsData>(userSettingsFile(), {\n    jsonParseErrorDefault: {},\n    cantReadFileDefault: {},\n  });\n}\n\nlet mkdirped = false;\n\nfunction dotExpoHomeDirectory() {\n  let dirPath = process.env.__UNSAFE_EXPO_HOME_DIRECTORY;\n  if (!dirPath) {\n    const home = os.homedir();\n\n    if (Env.isStaging()) {\n      dirPath = path.join(home, '.expo-staging');\n    } else if (Env.isLocal()) {\n      dirPath = path.join(home, '.expo-local');\n    } else {\n      dirPath = path.join(home, '.expo');\n    }\n  }\n  if (!mkdirped) {\n    fs.mkdirpSync(dirPath);\n    mkdirped = true;\n  }\n  return dirPath;\n}\n\n// returns an anonymous, unique identifier for a user on the current computer\nasync function getAnonymousIdentifierAsync(): Promise<string> {\n  const settings = await userSettingsJsonFile();\n  let id = await settings.getAsync('uuid', null);\n\n  if (!id) {\n    id = uuidv4();\n    await settings.setAsync('uuid', id);\n  }\n\n  return id;\n}\n\nfunction accessToken(): string | null {\n  return process.env.EXPO_TOKEN || null;\n}\n\nconst UserSettings = Object.assign(userSettingsJsonFile(), {\n  dotExpoHomeDirectory,\n  userSettingsFile,\n  userSettingsJsonFile,\n  accessToken,\n  getAnonymousIdentifierAsync,\n  SETTINGS_FILE_NAME,\n});\n\nexport default UserSettings;\n"],"mappings":"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"}