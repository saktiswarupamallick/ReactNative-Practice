{"version":3,"file":"Android.js","names":["_config","data","require","_configPlugins","osascript","_interopRequireWildcard","_spawnAsync","_interopRequireDefault","_chalk","_child_process","_trim","_os","_prompts","_semver","_internal","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_lastUrl","_isAdbOwner","BEGINNING_OF_ADB_ERROR_MESSAGE","CANT_START_ACTIVITY_ERROR","INSTALL_WARNING_TIMEOUT","EMULATOR_MAX_WAIT_TIMEOUT","whichEmulator","process","env","ANDROID_HOME","whichADB","getEmulatorsAsync","stdout","spawnAsync","split","os","EOL","filter","Boolean","map","name","type","isBooted","isAuthorized","getAbdNameForEmulatorIdAsync","emulatorId","_trim$split$shift","trim","getAdbOutputAsync","shift","getAllAvailableDevicesAsync","bootedDevices","getAttachedDevicesAsync","connectedNames","offlineEmulators","includes","allDevices","concat","length","genymotionMessage","Error","isBootAnimationCompleteAsync","pid","props","getPropertyDataForDeviceAsync","PROP_BOOT_ANIMATION_STATE","match","startEmulatorAsync","device","Logger","global","info","chalk","bold","emulatorProcess","child_process","spawn","stdio","detached","unref","Promise","resolve","reject","waitTimer","setInterval","connected","find","stopWaiting","maxTimer","setTimeout","manualCommand","stopWaitingAndReject","clearTimeout","clearInterval","message","on","output","splitItems","replace","attachedDevices","slice","line","devicePromises","deviceInfo","modelItem","_await$getAbdNameForE","all","isPlatformSupported","platform","adbAlreadyRunning","adb","result","lines","stderr","e","errorMessage","startsWith","substring","args","Binaries","addToPathAsync","alreadyRunning","Env","isDebug","join","signal","isAbortError","getAdbFileOutputAsync","encoding","execFileSync","_isDeviceAuthorizedAsync","isInstalledAsync","androidPackage","packages","adbPidArgs","i","_isExpoInstalledAsync","ensureDevClientInstalledAsync","applicationId","learnMore","isDevClientInstalledAsync","getExpoVersionAsync","regex","regexMatch","exec","isClientOutdatedAsync","sdkVersion","_clientForSdk$version","versions","Versions","versionsAsync","clientForSdk","getClientForSDK","latestVersionForSdk","version","androidVersion","installedVersion","semver","lt","installExpoAsync","url","warningTimer","setWarningTimer","notifications","code","LoadingEvent","START_PROGRESS_BAR","path","downloadApkAsync","progress","TICK_PROGRESS_BAR","STOP_PROGRESS_BAR","START_LOADING","installOnDeviceAsync","binaryPath","STOP_LOADING","isDeviceBootedAsync","_devices$find","devices","_devices$","uninstallExpoAsync","isInstalled","error","upgradeExpoAsync","attemptToStartEmulatorOrAssertAsync","_openUrlAsync","openClient","indexOf","openProject","getUnixPID","port","activateEmulatorWindowAsync","_match","androidPid","execAsync","openAppAsync","launchActivity","XDLError","logUnauthorized","warn","dim","hasPromptedToUpgrade","isManagedProjectAsync","projectRoot","AndroidConfig","Paths","getProjectPathOrThrowAsync","openUrlAsync","isDetached","devClient","exp","bootedDevice","underline","installedExpo","clientApplicationId","installExpoIfNeeded","_device$pid","shouldInstall","promptKey","confirm","Prompts","confirmAsync","initial","androidClient","getClientApplicationId","isManaged","_exp$android","android","package","resolveApplicationIdAsync","getAppBuildGradleFilePath","isInterstitiaLPageEnabled","isDevClientPackageInstalled","isDevClientInstalled","newProjectUrl","constructDeepLinkAsync","undefined","debug","Analytics","logEvent","sdkVersionString","sdkVersionsAsync","androidClientUrl","androidClientVersion","_exp$android$package","_exp$android2","applicationIdFromGradle","Package","getApplicationIdAsync","_androidManifest$mani","_androidManifest$mani2","filePath","getAndroidManifestAsync","androidManifest","Manifest","readAndroidManifestAsync","getMainActivityOrThrow","manifest","$","getConfig","skipSDKVersionRequirement","scheme","shouldGenerateInterstitialPage","UrlUtils","constructLoadingUrlAsync","catch","openProjectAsync","shouldPrompt","startAdbReverseAsync","projectUrl","booted","success","promptForDeviceAsync","_applicationId","gray","openWebProjectAsync","Webpack","getUrlAsync","packagerInfo","ProjectSettings","readPackagerInfoAsync","expRc","readExpRcAsync","userDefinedAdbReversePorts","extraAdbReversePorts","adbReversePorts","packagerPort","expoServerPort","adbReverse","stopAdbReverseAsync","adbReverseRemove","options","push","splashScreenDPIConstraints","dpi","sizeMultiplier","checkSplashScreenImages","_ref","_exp$android$splash$r","_exp$android3","_exp$android3$splash","_exp$splash","_exp$splash2","_exp$android4","gteSdkVersion","splashScreenMode","splash","resizeMode","generalSplashImagePath","image","italic","generalSplashImage","ImageUtils","getImageDimensionsAsync","androidSplash","androidSplashImages","imageRelativePath","splashImage","width","height","expectedWidth","expectedHeight","sizeMatches","some","maybeStopAdbDaemonAsync","nameStyleForDevice","isActive","text","pauseInteractions","value","prompts","limit","choices","item","format","title","suggest","input","RegExp","choice","test","resumeInteractions","DeviceABI","exports","deviceProperties","PROP_SDK_VERSION","PROP_API_VERSION","PROP_CPU_NAME","PROP_CPU_ABILIST_NAME","LOWEST_SUPPORTED_EXPO_API_VERSION","getDeviceSDKVersionAsync","getPropertyForDeviceAsync","getDeviceAPIVersionAsync","_await$getPropertyFor","parseInt","getDeviceABIsAsync","cpuAbilist","abi","shouldRefresh","prop","propCommand","results","toString","parseAdbDeviceProperties","devicePropertiesString","properties","propertyExp","matchAll"],"sources":["../src/Android.ts"],"sourcesContent":["import { ExpoConfig, getConfig, readExpRcAsync } from '@expo/config';\nimport { AndroidConfig } from '@expo/config-plugins';\nimport * as osascript from '@expo/osascript';\nimport spawnAsync from '@expo/spawn-async';\nimport chalk from 'chalk';\nimport child_process, { execFileSync } from 'child_process';\nimport trim from 'lodash/trim';\nimport os from 'os';\nimport prompts from 'prompts';\nimport semver from 'semver';\n\nimport {\n  Analytics,\n  Binaries,\n  downloadApkAsync,\n  Env,\n  ImageUtils,\n  isDevClientPackageInstalled,\n  learnMore,\n  LoadingEvent,\n  Logger,\n  ProjectSettings,\n  Prompts,\n  UrlUtils,\n  Versions,\n  Webpack,\n  XDLError,\n} from './internal';\n\nexport type Device = {\n  pid?: string;\n  name: string;\n  type: 'emulator' | 'device';\n  isBooted: boolean;\n  isAuthorized: boolean;\n};\n\nlet _lastUrl: string | null = null;\nlet _isAdbOwner: boolean | null = null;\n\nconst BEGINNING_OF_ADB_ERROR_MESSAGE = 'error: ';\nconst CANT_START_ACTIVITY_ERROR = 'Activity not started, unable to resolve Intent';\n\nconst INSTALL_WARNING_TIMEOUT = 60 * 1000;\n\nconst EMULATOR_MAX_WAIT_TIMEOUT = 60 * 1000 * 3;\n\nfunction whichEmulator(): string {\n  if (process.env.ANDROID_HOME) {\n    return `${process.env.ANDROID_HOME}/emulator/emulator`;\n  }\n  return 'emulator';\n}\n\nfunction whichADB(): string {\n  if (process.env.ANDROID_HOME) {\n    return `${process.env.ANDROID_HOME}/platform-tools/adb`;\n  }\n  return 'adb';\n}\n\n/**\n * Returns a list of emulator names.\n */\nasync function getEmulatorsAsync(): Promise<Device[]> {\n  try {\n    const { stdout } = await spawnAsync(whichEmulator(), ['-list-avds']);\n    return stdout\n      .split(os.EOL)\n      .filter(Boolean)\n      .map(name => ({\n        name,\n        type: 'emulator',\n        // unsure from this\n        isBooted: false,\n        isAuthorized: true,\n      }));\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Return the Emulator name for an emulator ID, this can be used to determine if an emulator is booted.\n *\n * @param emulatorId a value like `emulator-5554` from `abd devices`\n */\nasync function getAbdNameForEmulatorIdAsync(emulatorId: string): Promise<string | null> {\n  return (\n    trim(await getAdbOutputAsync(['-s', emulatorId, 'emu', 'avd', 'name']))\n      .split(/\\r?\\n/)\n      .shift() ?? null\n  );\n}\n\nexport async function getAllAvailableDevicesAsync(): Promise<Device[]> {\n  const bootedDevices = await getAttachedDevicesAsync();\n\n  const data = await getEmulatorsAsync();\n  const connectedNames = bootedDevices.map(({ name }) => name);\n\n  const offlineEmulators = data\n    .filter(({ name }) => !connectedNames.includes(name))\n    .map(({ name, type }) => {\n      return {\n        name,\n        type,\n        isBooted: false,\n        // TODO: Are emulators always authorized?\n        isAuthorized: true,\n      };\n    });\n\n  const allDevices = bootedDevices.concat(offlineEmulators);\n\n  if (!allDevices.length) {\n    const genymotionMessage = `https://developer.android.com/studio/run/device.html#developer-device-options. If you are using Genymotion go to Settings -> ADB, select \"Use custom Android SDK tools\", and point it at your Android SDK directory.`;\n    throw new Error(\n      `No Android connected device found, and no emulators could be started automatically.\\nPlease connect a device or create an emulator (https://docs.expo.dev/workflow/android-studio-emulator).\\nThen follow the instructions here to enable USB debugging:\\n${genymotionMessage}`\n    );\n  }\n\n  return allDevices;\n}\n\n/**\n * Returns true when a device's splash screen animation has stopped.\n * This can be used to detect when a device is fully booted and ready to use.\n *\n * @param pid\n */\nasync function isBootAnimationCompleteAsync(pid?: string): Promise<boolean> {\n  try {\n    const props = await getPropertyDataForDeviceAsync({ pid }, PROP_BOOT_ANIMATION_STATE);\n    return !!props[PROP_BOOT_ANIMATION_STATE].match(/stopped/);\n  } catch {\n    return false;\n  }\n}\n\nasync function startEmulatorAsync(device: Pick<Device, 'name'>): Promise<Device> {\n  Logger.global.info(`\\u203A Opening emulator ${chalk.bold(device.name)}`);\n\n  // Start a process to open an emulator\n  const emulatorProcess = child_process.spawn(\n    whichEmulator(),\n    [\n      `@${device.name}`,\n      // disable animation for faster boot -- this might make it harder to detect if it mounted properly tho\n      //'-no-boot-anim'\n      // '-google-maps-key' -- TODO: Use from config\n    ],\n    {\n      stdio: 'ignore',\n      detached: true,\n    }\n  );\n\n  emulatorProcess.unref();\n\n  return new Promise<Device>((resolve, reject) => {\n    const waitTimer = setInterval(async () => {\n      const bootedDevices = await getAttachedDevicesAsync();\n      const connected = bootedDevices.find(({ name }) => name === device.name);\n      if (connected) {\n        const isBooted = await isBootAnimationCompleteAsync(connected.pid);\n        if (isBooted) {\n          stopWaiting();\n          resolve(connected);\n        }\n      }\n    }, 1000);\n\n    // Reject command after timeout\n    const maxTimer = setTimeout(() => {\n      const manualCommand = `${whichEmulator()} @${device.name}`;\n      stopWaitingAndReject(\n        `It took too long to start the Android emulator: ${device.name}. You can try starting the emulator manually from the terminal with: ${manualCommand}`\n      );\n    }, EMULATOR_MAX_WAIT_TIMEOUT);\n\n    const stopWaiting = () => {\n      clearTimeout(maxTimer);\n      clearInterval(waitTimer);\n    };\n\n    const stopWaitingAndReject = (message: string) => {\n      stopWaiting();\n      reject(new Error(message));\n      clearInterval(waitTimer);\n    };\n\n    emulatorProcess.on('error', ({ message }) => stopWaitingAndReject(message));\n\n    emulatorProcess.on('exit', () => {\n      const manualCommand = `${whichEmulator()} @${device.name}`;\n      stopWaitingAndReject(\n        `The emulator (${device.name}) quit before it finished opening. You can try starting the emulator manually from the terminal with: ${manualCommand}`\n      );\n    });\n  });\n}\n\n// TODO: This is very expensive for some operations.\nexport async function getAttachedDevicesAsync(): Promise<Device[]> {\n  const output = await getAdbOutputAsync(['devices', '-l']);\n\n  const splitItems = output.trim().replace(/\\n$/, '').split(os.EOL);\n  // First line is `\"List of devices attached\"`, remove it\n  // @ts-ignore: todo\n  const attachedDevices: {\n    props: string[];\n    type: Device['type'];\n    isAuthorized: Device['isAuthorized'];\n  }[] = splitItems\n    .slice(1, splitItems.length)\n    .map(line => {\n      // unauthorized: ['FA8251A00719', 'unauthorized', 'usb:338690048X', 'transport_id:5']\n      // authorized: ['FA8251A00719', 'device', 'usb:336592896X', 'product:walleye', 'model:Pixel_2', 'device:walleye', 'transport_id:4']\n      // emulator: ['emulator-5554', 'offline', 'transport_id:1']\n      const props = line.split(' ').filter(Boolean);\n\n      const isAuthorized = props[1] !== 'unauthorized';\n      const type = line.includes('emulator') ? 'emulator' : 'device';\n      return { props, type, isAuthorized };\n    })\n    .filter(({ props: [pid] }) => !!pid);\n\n  const devicePromises = attachedDevices.map<Promise<Device>>(async props => {\n    const {\n      type,\n      props: [pid, ...deviceInfo],\n      isAuthorized,\n    } = props;\n\n    let name: string | null = null;\n\n    if (type === 'device') {\n      if (isAuthorized) {\n        // Possibly formatted like `model:Pixel_2`\n        // Transform to `Pixel_2`\n        const modelItem = deviceInfo.find(info => info.includes('model:'));\n        if (modelItem) {\n          name = modelItem.replace('model:', '');\n        }\n      }\n      // unauthorized devices don't have a name available to read\n      if (!name) {\n        // Device FA8251A00719\n        name = `Device ${pid}`;\n      }\n    } else {\n      // Given an emulator pid, get the emulator name which can be used to start the emulator later.\n      name = (await getAbdNameForEmulatorIdAsync(pid)) ?? '';\n    }\n\n    return {\n      pid,\n      name,\n      type,\n      isAuthorized,\n      isBooted: true,\n    };\n  });\n\n  return Promise.all(devicePromises);\n}\n\nexport function isPlatformSupported(): boolean {\n  return (\n    process.platform === 'darwin' || process.platform === 'win32' || process.platform === 'linux'\n  );\n}\n\nasync function adbAlreadyRunning(adb: string): Promise<boolean> {\n  try {\n    const result = await spawnAsync(adb, ['start-server']);\n    const lines = trim(result.stderr).split(/\\r?\\n/);\n    return lines.includes('* daemon started successfully') === false;\n  } catch (e: any) {\n    let errorMessage = trim(e.stderr || e.stdout);\n    if (errorMessage.startsWith(BEGINNING_OF_ADB_ERROR_MESSAGE)) {\n      errorMessage = errorMessage.substring(BEGINNING_OF_ADB_ERROR_MESSAGE.length);\n    }\n    e.message = errorMessage;\n    throw e;\n  }\n}\n\nexport async function getAdbOutputAsync(args: string[]): Promise<string> {\n  await Binaries.addToPathAsync('adb');\n  const adb = whichADB();\n\n  if (_isAdbOwner === null) {\n    const alreadyRunning = await adbAlreadyRunning(adb);\n    _isAdbOwner = alreadyRunning === false;\n  }\n\n  if (Env.isDebug()) {\n    Logger.global.info([adb, ...args].join(' '));\n  }\n  try {\n    const result = await spawnAsync(adb, args);\n    return result.output.join('\\n');\n  } catch (e: any) {\n    // User pressed ctrl+c to cancel the process...\n    if (e.signal === 'SIGINT') {\n      e.isAbortError = true;\n    }\n    // TODO: Support heap corruption for adb 29 (process exits with code -1073740940) (windows and linux)\n    let errorMessage = (e.stderr || e.stdout || e.message).trim();\n    if (errorMessage.startsWith(BEGINNING_OF_ADB_ERROR_MESSAGE)) {\n      errorMessage = errorMessage.substring(BEGINNING_OF_ADB_ERROR_MESSAGE.length);\n    }\n    e.message = errorMessage;\n    throw e;\n  }\n}\n\nexport async function getAdbFileOutputAsync(args: string[], encoding?: 'latin1') {\n  await Binaries.addToPathAsync('adb');\n  const adb = whichADB();\n\n  if (_isAdbOwner === null) {\n    const alreadyRunning = await adbAlreadyRunning(adb);\n    _isAdbOwner = alreadyRunning === false;\n  }\n\n  try {\n    return await execFileSync(adb, args, {\n      encoding,\n      stdio: 'pipe',\n    });\n  } catch (e: any) {\n    let errorMessage = (e.stderr || e.stdout || e.message).trim();\n    if (errorMessage.startsWith(BEGINNING_OF_ADB_ERROR_MESSAGE)) {\n      errorMessage = errorMessage.substring(BEGINNING_OF_ADB_ERROR_MESSAGE.length);\n    }\n    e.message = errorMessage;\n    throw e;\n  }\n}\n\nasync function _isDeviceAuthorizedAsync(device: Device): Promise<boolean> {\n  // TODO: Get the latest version of the device in case isAuthorized changes.\n  return device.isAuthorized;\n}\n\nasync function isInstalledAsync(device: Device, androidPackage: string): Promise<boolean> {\n  const packages = await getAdbOutputAsync(\n    adbPidArgs(device.pid, 'shell', 'pm', 'list', 'packages', androidPackage)\n  );\n\n  const lines = packages.split(/\\r?\\n/);\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i].trim();\n    if (line === `package:${androidPackage}`) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// Expo installed\nasync function _isExpoInstalledAsync(device: Device) {\n  return await isInstalledAsync(device, 'host.exp.exponent');\n}\n\nasync function ensureDevClientInstalledAsync(device: Device, applicationId: string): Promise<void> {\n  if (!(await isInstalledAsync(device, applicationId))) {\n    throw new Error(\n      `The development client (${applicationId}) for this project is not installed. ` +\n        `Please build and install the client on the device first.\\n${learnMore(\n          'https://docs.expo.dev/clients/distribution-for-android/'\n        )}`\n    );\n  }\n}\n\nasync function isDevClientInstalledAsync(device: Device, applicationId: string): Promise<boolean> {\n  return await isInstalledAsync(device, applicationId);\n}\n\nasync function getExpoVersionAsync(device: Device): Promise<string | null> {\n  const info = await getAdbOutputAsync(\n    adbPidArgs(device.pid, 'shell', 'dumpsys', 'package', 'host.exp.exponent')\n  );\n\n  const regex = /versionName=([0-9.]+)/;\n  const regexMatch = regex.exec(info);\n  if (!regexMatch || regexMatch.length < 2) {\n    return null;\n  }\n\n  return regexMatch[1];\n}\n\nasync function isClientOutdatedAsync(device: Device, sdkVersion?: string): Promise<boolean> {\n  const versions = await Versions.versionsAsync();\n  const clientForSdk = await getClientForSDK(sdkVersion);\n  const latestVersionForSdk = clientForSdk?.version ?? versions.androidVersion;\n  const installedVersion = await getExpoVersionAsync(device);\n  return !installedVersion || semver.lt(installedVersion, latestVersionForSdk);\n}\n\nexport async function installExpoAsync({\n  device,\n  url,\n  version,\n}: {\n  device: Device;\n  url?: string;\n  version?: string;\n}) {\n  let warningTimer: NodeJS.Timeout;\n  const setWarningTimer = () => {\n    if (warningTimer) {\n      clearTimeout(warningTimer);\n    }\n    return setTimeout(() => {\n      Logger.global.info('');\n      Logger.global.info(\n        'This download is taking longer than expected. You can also try downloading the clients from the website at https://expo.dev/tools'\n      );\n    }, INSTALL_WARNING_TIMEOUT);\n  };\n\n  Logger.notifications.info(\n    { code: LoadingEvent.START_PROGRESS_BAR },\n    'Downloading the Expo Go app [:bar] :percent :etas'\n  );\n\n  warningTimer = setWarningTimer();\n  const path = await downloadApkAsync(url, progress => {\n    Logger.notifications.info({ code: LoadingEvent.TICK_PROGRESS_BAR }, progress);\n  });\n\n  Logger.notifications.info({ code: LoadingEvent.STOP_PROGRESS_BAR });\n\n  const message = version\n    ? `Installing Expo Go ${version} on ${device.name}`\n    : `Installing Expo Go on ${device.name}`;\n\n  Logger.notifications.info({ code: LoadingEvent.START_LOADING }, message);\n  warningTimer = setWarningTimer();\n  const result = await installOnDeviceAsync(device, { binaryPath: path });\n  Logger.notifications.info({ code: LoadingEvent.STOP_LOADING });\n\n  clearTimeout(warningTimer);\n  return result;\n}\n\nexport async function installOnDeviceAsync(\n  device: Pick<Device, 'pid'>,\n  { binaryPath }: { binaryPath: string }\n) {\n  return await getAdbOutputAsync(adbPidArgs(device.pid, 'install', '-r', '-d', binaryPath));\n}\n\nexport async function isDeviceBootedAsync({\n  name,\n}: { name?: string } = {}): Promise<Device | null> {\n  const devices = await getAttachedDevicesAsync();\n\n  if (!name) {\n    return devices[0] ?? null;\n  }\n\n  return devices.find(device => device.name === name) ?? null;\n}\n\nexport async function uninstallExpoAsync(device: Device): Promise<string | undefined> {\n  Logger.global.info('Uninstalling Expo Go from Android device.');\n\n  // we need to check if its installed, else we might bump into \"Failure [DELETE_FAILED_INTERNAL_ERROR]\"\n  const isInstalled = await _isExpoInstalledAsync(device);\n  if (!isInstalled) {\n    return;\n  }\n\n  try {\n    return await getAdbOutputAsync(adbPidArgs(device.pid, 'uninstall', 'host.exp.exponent'));\n  } catch (e: any) {\n    Logger.global.error(\n      'Could not uninstall Expo Go from your device, please uninstall Expo Go manually and try again.'\n    );\n    throw e;\n  }\n}\n\nexport async function upgradeExpoAsync({\n  url,\n  version,\n  device,\n}: {\n  url?: string;\n  version?: string;\n  device?: Device | null;\n} = {}): Promise<boolean> {\n  try {\n    if (!device) {\n      device = (await getAttachedDevicesAsync())[0];\n      if (!device) {\n        throw new Error('no devices connected');\n      }\n    }\n    device = await attemptToStartEmulatorOrAssertAsync(device);\n    if (!device) {\n      return false;\n    }\n\n    await uninstallExpoAsync(device);\n    await installExpoAsync({ device, url, version });\n    if (_lastUrl) {\n      Logger.global.info(`\\u203A Opening ${_lastUrl} in Expo.`);\n      await getAdbOutputAsync([\n        'shell',\n        'am',\n        'start',\n        '-a',\n        'android.intent.action.VIEW',\n        '-d',\n        _lastUrl,\n      ]);\n      _lastUrl = null;\n    }\n\n    return true;\n  } catch (e: any) {\n    Logger.global.error(e.message);\n    return false;\n  }\n}\n\nasync function _openUrlAsync({\n  pid,\n  url,\n  applicationId,\n}: {\n  pid: string;\n  url: string;\n  applicationId: string;\n}) {\n  // NOTE(brentvatne): temporary workaround! launch Expo Go first, then\n  // launch the project!\n  // https://github.com/expo/expo/issues/7772\n  // adb shell monkey -p host.exp.exponent -c android.intent.category.LAUNCHER 1\n  // Note: this is not needed in Expo Development Client, it only applies to Expo Go\n  if (applicationId === 'host.exp.exponent') {\n    const openClient = await getAdbOutputAsync(\n      adbPidArgs(\n        pid,\n        'shell',\n        'monkey',\n        '-p',\n        applicationId,\n        '-c',\n        'android.intent.category.LAUNCHER',\n        '1'\n      )\n    );\n    if (openClient.includes(CANT_START_ACTIVITY_ERROR)) {\n      throw new Error(openClient.substring(openClient.indexOf('Error: ')));\n    }\n  }\n\n  const openProject = await getAdbOutputAsync(\n    adbPidArgs(pid, 'shell', 'am', 'start', '-a', 'android.intent.action.VIEW', '-d', url)\n  );\n  if (openProject.includes(CANT_START_ACTIVITY_ERROR)) {\n    throw new Error(openProject.substring(openProject.indexOf('Error: ')));\n  }\n\n  return openProject;\n}\n\nfunction getUnixPID(port: number | string) {\n  return execFileSync('lsof', [`-i:${port}`, '-P', '-t', '-sTCP:LISTEN'], {\n    encoding: 'utf8',\n    stdio: ['pipe', 'pipe', 'ignore'],\n  })\n    .split('\\n')[0]\n    .trim();\n}\n\nexport async function activateEmulatorWindowAsync(device: Pick<Device, 'type' | 'pid'>) {\n  if (\n    // only mac is supported for now.\n    process.platform !== 'darwin' ||\n    // can only focus emulators\n    device.type !== 'emulator'\n  ) {\n    return;\n  }\n\n  // Google Emulator ID: `emulator-5554` -> `5554`\n  const androidPid = device.pid!.match(/-(\\d+)/)?.[1];\n  if (!androidPid) {\n    return;\n  }\n  // Unix PID\n  const pid = getUnixPID(androidPid);\n\n  try {\n    await osascript.execAsync(`\n  tell application \"System Events\"\n    set frontmost of the first process whose unix id is ${pid} to true\n  end tell`);\n  } catch {\n    // noop -- this feature is very specific and subject to failure.\n  }\n}\n\n/**\n * @param device Android device to open on\n * @param props.launchActivity Activity to launch `[application identifier]/.[main activity name]`, ex: `com.bacon.app/.MainActivity`\n */\nexport async function openAppAsync(\n  device: Pick<Device, 'pid' | 'type'>,\n  {\n    launchActivity,\n  }: {\n    launchActivity: string;\n  }\n) {\n  const openProject = await getAdbOutputAsync(\n    adbPidArgs(\n      device.pid,\n      'shell',\n      'am',\n      'start',\n      '-a',\n      'android.intent.action.RUN',\n      // FLAG_ACTIVITY_SINGLE_TOP -- If set, the activity will not be launched if it is already running at the top of the history stack.\n      '-f',\n      '0x20000000',\n      // Activity to open first: com.bacon.app/.MainActivity\n      '-n',\n      launchActivity\n    )\n  );\n\n  // App is not installed or main activity cannot be found\n  if (openProject.match(/Error: Activity class .* does not exist./g)) {\n    throw new XDLError('APP_NOT_INSTALLED', openProject.substring(openProject.indexOf('Error: ')));\n  }\n\n  await activateEmulatorWindowAsync(device);\n\n  return openProject;\n}\n\nexport async function attemptToStartEmulatorOrAssertAsync(device: Device): Promise<Device | null> {\n  // TODO: Add a light-weight method for checking since a device could disconnect.\n\n  if (!(await isDeviceBootedAsync(device))) {\n    device = await startEmulatorAsync(device);\n  }\n\n  if (!(await _isDeviceAuthorizedAsync(device))) {\n    logUnauthorized(device);\n    return null;\n  }\n\n  return device;\n}\n\nfunction logUnauthorized(device: Device) {\n  Logger.global.warn(\n    `\\nThis computer is not authorized for developing on ${chalk.bold(device.name)}. ${chalk.dim(\n      learnMore('https://expo.fyi/authorize-android-device')\n    )}`\n  );\n}\n\n// Keep a list of simulator UDIDs so we can prevent asking multiple times if a user wants to upgrade.\n// This can prevent annoying interactions when they don't want to upgrade for whatever reason.\nconst hasPromptedToUpgrade: Record<string, boolean> = {};\n\nasync function isManagedProjectAsync(projectRoot: string) {\n  try {\n    await AndroidConfig.Paths.getProjectPathOrThrowAsync(projectRoot);\n    return false;\n  } catch {\n    return true;\n  }\n}\n\nasync function openUrlAsync({\n  url,\n  device,\n  isDetached = false,\n  sdkVersion,\n  devClient = false,\n  exp,\n  projectRoot,\n}: {\n  url: string;\n  isDetached?: boolean;\n  device: Device;\n  sdkVersion?: string;\n  devClient?: boolean;\n  exp?: ExpoConfig;\n  projectRoot: string;\n}): Promise<void> {\n  const bootedDevice = await attemptToStartEmulatorOrAssertAsync(device);\n  if (!bootedDevice) {\n    return;\n  }\n  Logger.global.info(`\\u203A Opening ${chalk.underline(url)} on ${chalk.bold(bootedDevice.name)}`);\n\n  await activateEmulatorWindowAsync(bootedDevice);\n\n  device = bootedDevice;\n  let installedExpo = false;\n  let clientApplicationId = 'host.exp.exponent';\n\n  const installExpoIfNeeded = async (device: Device) => {\n    let shouldInstall = !(await _isExpoInstalledAsync(device));\n    const promptKey = device.pid ?? 'unknown';\n    if (\n      !shouldInstall &&\n      !hasPromptedToUpgrade[promptKey] &&\n      (await isClientOutdatedAsync(device, sdkVersion))\n    ) {\n      // Only prompt once per device, per run.\n      hasPromptedToUpgrade[promptKey] = true;\n      const confirm = await Prompts.confirmAsync({\n        initial: true,\n        message: `Expo Go on ${device.name} (${device.type}) is outdated, would you like to upgrade?`,\n      });\n      if (confirm) {\n        await uninstallExpoAsync(device);\n        shouldInstall = true;\n      }\n    }\n\n    if (shouldInstall) {\n      const androidClient = await getClientForSDK(sdkVersion);\n      await installExpoAsync({ device, ...androidClient });\n      installedExpo = true;\n    }\n  };\n\n  const getClientApplicationId = async () => {\n    let applicationId;\n    const isManaged = await isManagedProjectAsync(projectRoot);\n    if (isManaged) {\n      applicationId = exp?.android?.package;\n      if (!applicationId) {\n        throw new Error(\n          `Could not find property android.package in app.config.js/app.json. This setting is required to launch the app.`\n        );\n      }\n    } else {\n      applicationId = await resolveApplicationIdAsync(projectRoot);\n      if (!applicationId) {\n        throw new Error(\n          `Could not find applicationId in ${AndroidConfig.Paths.getAppBuildGradleFilePath(\n            projectRoot\n          )}`\n        );\n      }\n    }\n    return applicationId;\n  };\n\n  try {\n    if (devClient) {\n      clientApplicationId = await getClientApplicationId();\n      await ensureDevClientInstalledAsync(device, clientApplicationId);\n    } else if (\n      Env.isInterstitiaLPageEnabled() &&\n      !devClient &&\n      isDevClientPackageInstalled(projectRoot)\n    ) {\n      await installExpoIfNeeded(device);\n\n      let applicationId: string | undefined;\n      try {\n        applicationId = await getClientApplicationId();\n      } catch (e: any) {\n        Logger.global.warn(e);\n      }\n\n      const isDevClientInstalled = applicationId\n        ? await isDevClientInstalledAsync(device, applicationId)\n        : false;\n\n      if (isDevClientInstalled) {\n        // Everything is installed, we can present the interstitial page.\n        clientApplicationId = ''; // it will open browser\n      } else {\n        // The development build isn't available. So let's fall back to Expo Go.\n        Logger.global.warn(\n          `\\u203A The 'expo-dev-client' package is installed, but a development build isn't available.\\nYour app will open in Expo Go instead. If you want to use the development build, please install it on the simulator first.\\n${learnMore(\n            'https://docs.expo.dev/development/build/'\n          )}`\n        );\n\n        const newProjectUrl = await constructDeepLinkAsync(projectRoot, undefined, false, false);\n        if (!newProjectUrl) {\n          // This shouldn't happen.\n          throw Error('Could not generate a deep link for your project.');\n        }\n        url = newProjectUrl;\n        Logger.global.debug(`iOS project url: ${url}`);\n        _lastUrl = url;\n      }\n    } else if (!isDetached) {\n      await installExpoIfNeeded(device);\n      _lastUrl = url;\n      // _checkExpoUpToDateAsync(); // let this run in background\n    }\n\n    try {\n      await _openUrlAsync({ pid: device.pid!, url, applicationId: clientApplicationId });\n    } catch (e: any) {\n      if (isDetached) {\n        e.message = `Error running app. Have you installed the app already using Android Studio? Since you are detached you must build manually. ${e.message}`;\n      } else {\n        e.message = `Error running app. ${e.message}`;\n      }\n\n      throw e;\n    }\n\n    if (device.type === 'emulator') {\n      // TODO: Bring the emulator window to the front.\n    }\n\n    Analytics.logEvent('Open Url on Device', {\n      platform: 'android',\n      installedExpo,\n    });\n  } catch (e: any) {\n    e.message = `Error running adb: ${e.message}`;\n    throw e;\n  }\n}\n\nasync function getClientForSDK(sdkVersionString?: string) {\n  if (!sdkVersionString) {\n    return null;\n  }\n\n  const sdkVersion = (await Versions.sdkVersionsAsync())[sdkVersionString];\n  if (!sdkVersion) {\n    return null;\n  }\n\n  return {\n    url: sdkVersion.androidClientUrl,\n    version: sdkVersion.androidClientVersion,\n  };\n}\n\nexport async function resolveApplicationIdAsync(projectRoot: string): Promise<string | null> {\n  try {\n    const applicationIdFromGradle = await AndroidConfig.Package.getApplicationIdAsync(projectRoot);\n    if (applicationIdFromGradle) {\n      return applicationIdFromGradle;\n    }\n  } catch {}\n\n  try {\n    const filePath = await AndroidConfig.Paths.getAndroidManifestAsync(projectRoot);\n    const androidManifest = await AndroidConfig.Manifest.readAndroidManifestAsync(filePath);\n    // Assert MainActivity defined.\n    await AndroidConfig.Manifest.getMainActivityOrThrow(androidManifest);\n    if (androidManifest.manifest?.$?.package) {\n      return androidManifest.manifest.$.package;\n    }\n  } catch {}\n\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n  return exp.android?.package ?? null;\n}\n\nasync function constructDeepLinkAsync(\n  projectRoot: string,\n  scheme?: string,\n  devClient?: boolean,\n  shouldGenerateInterstitialPage: boolean = true\n): Promise<string | null> {\n  if (\n    Env.isInterstitiaLPageEnabled() &&\n    !devClient &&\n    isDevClientPackageInstalled(projectRoot) &&\n    shouldGenerateInterstitialPage\n  ) {\n    return UrlUtils.constructLoadingUrlAsync(projectRoot, 'android');\n  } else {\n    return await UrlUtils.constructDeepLinkAsync(projectRoot, {\n      scheme,\n    }).catch(e => {\n      if (devClient) {\n        return null;\n      }\n      throw e;\n    });\n  }\n}\n\nexport async function openProjectAsync({\n  projectRoot,\n  shouldPrompt,\n  devClient = false,\n  device,\n  scheme,\n  applicationId,\n  launchActivity,\n}: {\n  projectRoot: string;\n  shouldPrompt?: boolean;\n  devClient?: boolean;\n  device?: Device;\n  scheme?: string;\n  applicationId?: string | null;\n  launchActivity?: string;\n}): Promise<{ success: true; url: string } | { success: false; error: Error | string }> {\n  await startAdbReverseAsync(projectRoot);\n\n  const projectUrl = await constructDeepLinkAsync(projectRoot, scheme, devClient);\n\n  const { exp } = getConfig(projectRoot, {\n    skipSDKVersionRequirement: true,\n  });\n\n  // Resolve device\n  if (device) {\n    const booted = await attemptToStartEmulatorOrAssertAsync(device);\n    if (!booted) {\n      return { success: false, error: 'escaped' };\n    }\n    device = booted;\n  } else {\n    const devices = await getAllAvailableDevicesAsync();\n    let booted: Device | null = devices[0];\n    if (shouldPrompt) {\n      booted = await promptForDeviceAsync(devices);\n    }\n    if (!booted) {\n      return { success: false, error: 'escaped' };\n    }\n    device = booted;\n  }\n\n  // No URL, and is devClient\n  if (!projectUrl) {\n    if (!launchActivity) {\n      applicationId = applicationId ?? (await resolveApplicationIdAsync(projectRoot));\n      if (!applicationId) {\n        return {\n          success: false,\n          error:\n            'Cannot resolve application identifier or URI scheme to open the native Android app.\\nBuild the native app with `expo run:android` or `eas build -p android`',\n        };\n      }\n      launchActivity = `${applicationId}/.MainActivity`;\n    }\n\n    try {\n      await openAppAsync(device, {\n        launchActivity,\n      });\n    } catch (error: any) {\n      let errorMessage = `Couldn't open Android app with activity \"${launchActivity}\" on device \"${device.name}\".`;\n      if (error instanceof XDLError && error.code === 'APP_NOT_INSTALLED') {\n        errorMessage += `\\nThe app might not be installed, try installing it with: ${chalk.bold(\n          `expo run:android -d ${device.name}`\n        )}`;\n      }\n      errorMessage += chalk.gray(`\\n${error.message}`);\n      error.message = errorMessage;\n      return { success: false, error };\n    }\n    return {\n      success: true,\n      // TODO: Remove this hack\n      url: '',\n    };\n  }\n\n  try {\n    await openUrlAsync({\n      url: projectUrl,\n      device,\n      isDetached: !!exp.isDetached,\n      sdkVersion: exp.sdkVersion,\n      devClient,\n      exp,\n      projectRoot,\n    });\n    return { success: true, url: projectUrl };\n  } catch (e: any) {\n    if (e.isAbortError) {\n      // Don't log anything when the user cancelled the process\n      return { success: false, error: 'escaped' };\n    } else {\n      e.message = `Couldn't start project on Android: ${e.message}`;\n    }\n    return { success: false, error: e };\n  }\n}\n\nexport async function openWebProjectAsync({\n  projectRoot,\n  shouldPrompt,\n}: {\n  projectRoot: string;\n  shouldPrompt?: boolean;\n}): Promise<{ success: true; url: string } | { success: false; error: string }> {\n  try {\n    await startAdbReverseAsync(projectRoot);\n\n    const projectUrl = await Webpack.getUrlAsync(projectRoot);\n    if (projectUrl === null) {\n      return {\n        success: false,\n        error: `The web project has not been started yet`,\n      };\n    }\n    const devices = await getAllAvailableDevicesAsync();\n    let device: Device | null = devices[0];\n    if (shouldPrompt) {\n      device = await promptForDeviceAsync(devices);\n    }\n    if (!device) {\n      return { success: false, error: 'escaped' };\n    }\n\n    await openUrlAsync({ url: projectUrl, device, isDetached: true, projectRoot });\n    return { success: true, url: projectUrl };\n  } catch (e: any) {\n    return { success: false, error: `Couldn't open the web project on Android: ${e.message}` };\n  }\n}\n\n// Adb reverse\nexport async function startAdbReverseAsync(projectRoot: string): Promise<boolean> {\n  const packagerInfo = await ProjectSettings.readPackagerInfoAsync(projectRoot);\n  const expRc = await readExpRcAsync(projectRoot);\n  const userDefinedAdbReversePorts = expRc.extraAdbReversePorts || [];\n\n  const adbReversePorts = [\n    packagerInfo.packagerPort,\n    packagerInfo.expoServerPort,\n    ...userDefinedAdbReversePorts,\n  ].filter(Boolean);\n\n  const devices = await getAttachedDevicesAsync();\n  for (const device of devices) {\n    for (const port of adbReversePorts) {\n      if (!(await adbReverse({ device, port }))) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n\nexport async function stopAdbReverseAsync(projectRoot: string): Promise<void> {\n  const packagerInfo = await ProjectSettings.readPackagerInfoAsync(projectRoot);\n  const expRc = await readExpRcAsync(projectRoot);\n  const userDefinedAdbReversePorts = expRc.extraAdbReversePorts || [];\n\n  const adbReversePorts = [\n    packagerInfo.packagerPort,\n    packagerInfo.expoServerPort,\n    ...userDefinedAdbReversePorts,\n  ].filter(Boolean);\n\n  const devices = await getAttachedDevicesAsync();\n  for (const device of devices) {\n    for (const port of adbReversePorts) {\n      await adbReverseRemove({ device, port });\n    }\n  }\n}\n\nasync function adbReverse({ device, port }: { device: Device; port: number }): Promise<boolean> {\n  if (!(await _isDeviceAuthorizedAsync(device))) {\n    return false;\n  }\n\n  try {\n    await getAdbOutputAsync(adbPidArgs(device.pid, 'reverse', `tcp:${port}`, `tcp:${port}`));\n    return true;\n  } catch (e: any) {\n    Logger.global.warn(`Couldn't adb reverse: ${e.message}`);\n    return false;\n  }\n}\n\nasync function adbReverseRemove({\n  device,\n  port,\n}: {\n  device: Device;\n  port: number;\n}): Promise<boolean> {\n  if (!(await _isDeviceAuthorizedAsync(device))) {\n    return false;\n  }\n\n  try {\n    await getAdbOutputAsync(adbPidArgs(device.pid, 'reverse', '--remove', `tcp:${port}`));\n    return true;\n  } catch (e: any) {\n    // Don't send this to warn because we call this preemptively sometimes\n    Logger.global.debug(`Couldn't adb reverse remove: ${e.message}`);\n    return false;\n  }\n}\n\nfunction adbPidArgs(pid: Device['pid'], ...options: string[]): string[] {\n  const args = [];\n  if (pid) {\n    args.push('-s', pid);\n  }\n  return args.concat(options);\n}\n\ntype DPIConstraint = {\n  dpi: 'mdpi' | 'hdpi' | 'xhdpi' | 'xxhdpi' | 'xxxhdpi';\n  sizeMultiplier: number;\n};\n\nconst splashScreenDPIConstraints: readonly DPIConstraint[] = [\n  {\n    dpi: 'mdpi',\n    sizeMultiplier: 1,\n  },\n  {\n    dpi: 'hdpi',\n    sizeMultiplier: 1.5,\n  },\n  {\n    dpi: 'xhdpi',\n    sizeMultiplier: 2,\n  },\n  {\n    dpi: 'xxhdpi',\n    sizeMultiplier: 3,\n  },\n  {\n    dpi: 'xxxhdpi',\n    sizeMultiplier: 4,\n  },\n];\n\n/**\n * Checks whether `resizeMode` is set to `native` and if `true` analyzes provided images for splashscreen\n * providing `Logger` feedback upon problems.\n * @param projectRoot - directory of the expo project\n * @since SDK33\n */\nexport async function checkSplashScreenImages(projectRoot: string): Promise<void> {\n  const { exp } = getConfig(projectRoot);\n\n  // return before SDK33\n  if (!Versions.gteSdkVersion(exp, '33.0.0')) {\n    return;\n  }\n\n  const splashScreenMode = exp.android?.splash?.resizeMode ?? exp.splash?.resizeMode ?? 'contain';\n\n  // only mode `native` is handled by this check\n  if (splashScreenMode === 'contain' || splashScreenMode === 'cover') {\n    return;\n  }\n\n  const generalSplashImagePath = exp.splash?.image;\n  if (!generalSplashImagePath) {\n    Logger.global.warn(\n      `Couldn't read '${chalk.italic('splash.image')}' from ${chalk.italic(\n        'app.json'\n      )}. Provide asset that would serve as baseline splash image.`\n    );\n    return;\n  }\n  const generalSplashImage = await ImageUtils.getImageDimensionsAsync(\n    projectRoot,\n    generalSplashImagePath\n  );\n  if (!generalSplashImage) {\n    Logger.global.warn(\n      `Couldn't read dimensions of provided splash image '${chalk.italic(\n        generalSplashImagePath\n      )}'. Does the file exist?`\n    );\n    return;\n  }\n\n  const androidSplash = exp.android?.splash;\n  const androidSplashImages = [];\n  for (const { dpi, sizeMultiplier } of splashScreenDPIConstraints) {\n    const imageRelativePath = androidSplash?.[dpi];\n    if (imageRelativePath) {\n      const splashImage = await ImageUtils.getImageDimensionsAsync(projectRoot, imageRelativePath);\n      if (!splashImage) {\n        Logger.global.warn(\n          `Couldn't read dimensions of provided splash image '${chalk.italic(\n            imageRelativePath\n          )}'. Does the file exist?`\n        );\n        continue;\n      }\n      const { width, height } = splashImage;\n      const expectedWidth = sizeMultiplier * generalSplashImage.width;\n      const expectedHeight = sizeMultiplier * generalSplashImage.height;\n      androidSplashImages.push({\n        dpi,\n        width,\n        height,\n        expectedWidth,\n        expectedHeight,\n        sizeMatches: width === expectedWidth && height === expectedHeight,\n      });\n    }\n  }\n\n  if (androidSplashImages.length === 0) {\n    Logger.global\n      .warn(`Splash resizeMode is set to 'native', but you haven't provided any images for different DPIs.\nBe aware that your splash image will be used as xxxhdpi asset and its ${chalk.bold(\n      'actual size will be different'\n    )} depending on device's DPI.\nSee https://docs.expo.dev/guides/splash-screens/#splash-screen-api-limitations-on-android for more information`);\n    return;\n  }\n\n  if (androidSplashImages.some(({ sizeMatches }) => !sizeMatches)) {\n    Logger.global\n      .warn(`Splash resizeMode is set to 'native' and you've provided different images for different DPIs,\nbut their sizes mismatch expected ones: [dpi: provided (expected)] ${androidSplashImages\n      .map(\n        ({ dpi, width, height, expectedWidth, expectedHeight }) =>\n          `${dpi}: ${width}x${height} (${expectedWidth}x${expectedHeight})`\n      )\n      .join(', ')}\nSee https://docs.expo.dev/guides/splash-screens/#splash-screen-api-limitations-on-android for more information`);\n  }\n}\n\nexport async function maybeStopAdbDaemonAsync() {\n  if (_isAdbOwner !== true) {\n    return false;\n  }\n\n  try {\n    await getAdbOutputAsync(['kill-server']);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nfunction nameStyleForDevice(device: Device) {\n  const isActive = device.isBooted;\n  if (!isActive) {\n    // Use no style changes for a disconnected device that is available to be opened.\n    return (text: string) => text;\n  }\n  // A device that is connected and ready to be used should be bolded to match iOS.\n  if (device.isAuthorized) {\n    return chalk.bold;\n  }\n  // Devices that are unauthorized and connected cannot be used, but they are connected so gray them out.\n  return (text: string) => chalk.bold(chalk.gray(text));\n}\n\nexport async function promptForDeviceAsync(devices: Device[]): Promise<Device | null> {\n  // TODO: provide an option to add or download more simulators\n\n  // Pause interactions on the TerminalUI\n  Prompts.pauseInteractions();\n\n  const { value } = await prompts({\n    type: 'autocomplete',\n    name: 'value',\n    limit: 11,\n    message: 'Select a device/emulator',\n    choices: devices.map(item => {\n      const format = nameStyleForDevice(item);\n      const type = item.isAuthorized ? item.type : 'unauthorized';\n      return {\n        title: `${format(item.name)} ${chalk.dim(`(${type})`)}`,\n        value: item.name,\n      };\n    }),\n    suggest: (input: any, choices: any) => {\n      const regex = new RegExp(input, 'i');\n      return choices.filter((choice: any) => regex.test(choice.title));\n    },\n  });\n\n  // Resume interactions on the TerminalUI\n  Prompts.resumeInteractions();\n\n  const device = value ? devices.find(({ name }) => name === value)! : null;\n\n  if (device?.isAuthorized === false) {\n    logUnauthorized(device);\n    return null;\n  }\n\n  return device;\n}\n\nexport enum DeviceABI {\n  // The arch specific android target platforms are soft-deprecated.\n  // Instead of using TargetPlatform as a combination arch + platform\n  // the code will be updated to carry arch information in [DarwinArch]\n  // and [AndroidArch].\n  arm = 'arm',\n  arm64 = 'arm64',\n  x64 = 'x64',\n  x86 = 'x86',\n  armeabiV7a = 'armeabi-v7a',\n  armeabi = 'armeabi',\n  universal = 'universal',\n}\n\ntype DeviceProperties = Record<string, string>;\nconst deviceProperties: Record<string, DeviceProperties> = {};\n\nconst PROP_SDK_VERSION = 'ro.build.version.release';\n// Can sometimes be null\nconst PROP_API_VERSION = 'ro.build.version.sdk';\n// http://developer.android.com/ndk/guides/abis.html\nconst PROP_CPU_NAME = 'ro.product.cpu.abi';\nconst PROP_CPU_ABILIST_NAME = 'ro.product.cpu.abilist';\nconst PROP_BOOT_ANIMATION_STATE = 'init.svc.bootanim';\n\nconst LOWEST_SUPPORTED_EXPO_API_VERSION = 21;\n\n/**\n * @returns string like '11' (i.e. Android 11)\n */\nexport async function getDeviceSDKVersionAsync(\n  device: Pick<Device, 'name' | 'pid'>\n): Promise<string> {\n  return await getPropertyForDeviceAsync(device, PROP_SDK_VERSION);\n}\n\n/**\n * @returns number like `30` (i.e. API 30)\n */\nexport async function getDeviceAPIVersionAsync(\n  device: Pick<Device, 'name' | 'pid'>\n): Promise<number> {\n  const sdkVersion =\n    (await getPropertyForDeviceAsync(device, PROP_API_VERSION)) ??\n    LOWEST_SUPPORTED_EXPO_API_VERSION;\n  return parseInt(sdkVersion, 10);\n}\n\nexport async function getDeviceABIsAsync(\n  device: Pick<Device, 'name' | 'pid'>\n): Promise<DeviceABI[]> {\n  const cpuAbilist = await getPropertyForDeviceAsync(device, PROP_CPU_ABILIST_NAME);\n\n  if (cpuAbilist) {\n    return cpuAbilist.trim().split(',') as DeviceABI[];\n  }\n\n  const abi = (await getPropertyForDeviceAsync(device, PROP_CPU_NAME)) as DeviceABI;\n  return [abi];\n}\n\nexport async function getPropertyForDeviceAsync(\n  device: Pick<Device, 'name' | 'pid'>,\n  name: string,\n  shouldRefresh?: boolean\n): Promise<string> {\n  if (shouldRefresh) {\n    delete deviceProperties[device.name];\n  }\n\n  if (deviceProperties[device.name] == null) {\n    try {\n      deviceProperties[device.name] = await getPropertyDataForDeviceAsync(device);\n    } catch (error: any) {\n      // TODO: Ensure error has message and not stderr\n      Logger.global.error(\n        `Failed to get properties for device \"${device.name}\" (${device.pid}): ${error.message}`\n      );\n    }\n  }\n  return deviceProperties[device.name][name];\n}\n\nasync function getPropertyDataForDeviceAsync(\n  device: Pick<Device, 'pid'>,\n  prop?: string\n): Promise<DeviceProperties> {\n  // @ts-ignore\n  const propCommand = adbPidArgs(...[device.pid, 'shell', 'getprop', prop].filter(Boolean));\n  try {\n    // Prevent reading as UTF8.\n    const results = (await getAdbFileOutputAsync(propCommand, 'latin1')).toString('latin1');\n    // Like:\n    // [wifi.direct.interface]: [p2p-dev-wlan0]\n    // [wifi.interface]: [wlan0]\n\n    if (prop) {\n      return {\n        [prop]: results,\n      };\n    }\n    return parseAdbDeviceProperties(results);\n  } catch (error: any) {\n    // TODO: Ensure error has message and not stderr\n    throw new Error(`Failed to get properties for device (${device.pid}): ${error.message}`);\n  }\n}\n\nexport function parseAdbDeviceProperties(devicePropertiesString: string) {\n  const properties: DeviceProperties = {};\n  const propertyExp = /\\[(.*?)\\]: \\[(.*?)\\]/gm;\n  for (const match of devicePropertiesString.matchAll(propertyExp)) {\n    properties[match[1]] = match[2];\n  }\n  return properties;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAAAA,QAAA;EAAA,MAAAC,IAAA,GAAAC,OAAA;EAAAF,OAAA,YAAAA,CAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAE,eAAA;EAAA,MAAAF,IAAA,GAAAC,OAAA;EAAAC,cAAA,YAAAA,CAAA;IAAA,OAAAF,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAG,UAAA;EAAA,MAAAH,IAAA,GAAAI,uBAAA,CAAAH,OAAA;EAAAE,SAAA,YAAAA,CAAA;IAAA,OAAAH,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAK,YAAA;EAAA,MAAAL,IAAA,GAAAM,sBAAA,CAAAL,OAAA;EAAAI,WAAA,YAAAA,CAAA;IAAA,OAAAL,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAO,OAAA;EAAA,MAAAP,IAAA,GAAAM,sBAAA,CAAAL,OAAA;EAAAM,MAAA,YAAAA,CAAA;IAAA,OAAAP,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAQ,eAAA;EAAA,MAAAR,IAAA,GAAAI,uBAAA,CAAAH,OAAA;EAAAO,cAAA,YAAAA,CAAA;IAAA,OAAAR,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAS,MAAA;EAAA,MAAAT,IAAA,GAAAM,sBAAA,CAAAL,OAAA;EAAAQ,KAAA,YAAAA,CAAA;IAAA,OAAAT,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAU,IAAA;EAAA,MAAAV,IAAA,GAAAM,sBAAA,CAAAL,OAAA;EAAAS,GAAA,YAAAA,CAAA;IAAA,OAAAV,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAW,SAAA;EAAA,MAAAX,IAAA,GAAAM,sBAAA,CAAAL,OAAA;EAAAU,QAAA,YAAAA,CAAA;IAAA,OAAAX,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAY,QAAA;EAAA,MAAAZ,IAAA,GAAAM,sBAAA,CAAAL,OAAA;EAAAW,OAAA,YAAAA,CAAA;IAAA,OAAAZ,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAEA,SAAAa,UAAA;EAAA,MAAAb,IAAA,GAAAC,OAAA;EAAAY,SAAA,YAAAA,CAAA;IAAA,OAAAb,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAgBoB,SAAAM,uBAAAQ,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAAA,SAAAG,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAd,wBAAAU,GAAA,EAAAI,WAAA,SAAAA,WAAA,IAAAJ,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAQ,KAAA,GAAAL,wBAAA,CAAAC,WAAA,OAAAI,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAT,GAAA,YAAAQ,KAAA,CAAAE,GAAA,CAAAV,GAAA,SAAAW,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAhB,GAAA,QAAAgB,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAnB,GAAA,EAAAgB,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAf,GAAA,EAAAgB,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAhB,GAAA,CAAAgB,GAAA,SAAAL,MAAA,CAAAT,OAAA,GAAAF,GAAA,MAAAQ,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAArB,GAAA,EAAAW,MAAA,YAAAA,MAAA;AAUpB,IAAIW,QAAuB,GAAG,IAAI;AAClC,IAAIC,WAA2B,GAAG,IAAI;AAEtC,MAAMC,8BAA8B,GAAG,SAAS;AAChD,MAAMC,yBAAyB,GAAG,gDAAgD;AAElF,MAAMC,uBAAuB,GAAG,EAAE,GAAG,IAAI;AAEzC,MAAMC,yBAAyB,GAAG,EAAE,GAAG,IAAI,GAAG,CAAC;AAE/C,SAASC,aAAaA,CAAA,EAAW;EAC/B,IAAIC,OAAO,CAACC,GAAG,CAACC,YAAY,EAAE;IAC5B,OAAQ,GAAEF,OAAO,CAACC,GAAG,CAACC,YAAa,oBAAmB;EACxD;EACA,OAAO,UAAU;AACnB;AAEA,SAASC,QAAQA,CAAA,EAAW;EAC1B,IAAIH,OAAO,CAACC,GAAG,CAACC,YAAY,EAAE;IAC5B,OAAQ,GAAEF,OAAO,CAACC,GAAG,CAACC,YAAa,qBAAoB;EACzD;EACA,OAAO,KAAK;AACd;;AAEA;AACA;AACA;AACA,eAAeE,iBAAiBA,CAAA,EAAsB;EACpD,IAAI;IACF,MAAM;MAAEC;IAAO,CAAC,GAAG,MAAM,IAAAC,qBAAU,EAACP,aAAa,CAAC,CAAC,EAAE,CAAC,YAAY,CAAC,CAAC;IACpE,OAAOM,MAAM,CACVE,KAAK,CAACC,aAAE,CAACC,GAAG,CAAC,CACbC,MAAM,CAACC,OAAO,CAAC,CACfC,GAAG,CAACC,IAAI,KAAK;MACZA,IAAI;MACJC,IAAI,EAAE,UAAU;MAChB;MACAC,QAAQ,EAAE,KAAK;MACfC,YAAY,EAAE;IAChB,CAAC,CAAC,CAAC;EACP,CAAC,CAAC,MAAM;IACN,OAAO,EAAE;EACX;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAeC,4BAA4BA,CAACC,UAAkB,EAA0B;EAAA,IAAAC,iBAAA;EACtF,QAAAA,iBAAA,GACE,IAAAC,eAAI,EAAC,MAAMC,iBAAiB,CAAC,CAAC,IAAI,EAAEH,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,CACpEX,KAAK,CAAC,OAAO,CAAC,CACde,KAAK,CAAC,CAAC,cAAAH,iBAAA,cAAAA,iBAAA,GAAI,IAAI;AAEtB;AAEO,eAAeI,2BAA2BA,CAAA,EAAsB;EACrE,MAAMC,aAAa,GAAG,MAAMC,uBAAuB,CAAC,CAAC;EAErD,MAAMpE,IAAI,GAAG,MAAM+C,iBAAiB,CAAC,CAAC;EACtC,MAAMsB,cAAc,GAAGF,aAAa,CAACZ,GAAG,CAAC,CAAC;IAAEC;EAAK,CAAC,KAAKA,IAAI,CAAC;EAE5D,MAAMc,gBAAgB,GAAGtE,IAAI,CAC1BqD,MAAM,CAAC,CAAC;IAAEG;EAAK,CAAC,KAAK,CAACa,cAAc,CAACE,QAAQ,CAACf,IAAI,CAAC,CAAC,CACpDD,GAAG,CAAC,CAAC;IAAEC,IAAI;IAAEC;EAAK,CAAC,KAAK;IACvB,OAAO;MACLD,IAAI;MACJC,IAAI;MACJC,QAAQ,EAAE,KAAK;MACf;MACAC,YAAY,EAAE;IAChB,CAAC;EACH,CAAC,CAAC;EAEJ,MAAMa,UAAU,GAAGL,aAAa,CAACM,MAAM,CAACH,gBAAgB,CAAC;EAEzD,IAAI,CAACE,UAAU,CAACE,MAAM,EAAE;IACtB,MAAMC,iBAAiB,GAAI,sNAAqN;IAChP,MAAM,IAAIC,KAAK,CACZ,6PAA4PD,iBAAkB,EACjR,CAAC;EACH;EAEA,OAAOH,UAAU;AACnB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,eAAeK,4BAA4BA,CAACC,GAAY,EAAoB;EAC1E,IAAI;IACF,MAAMC,KAAK,GAAG,MAAMC,6BAA6B,CAAC;MAAEF;IAAI,CAAC,EAAEG,yBAAyB,CAAC;IACrF,OAAO,CAAC,CAACF,KAAK,CAACE,yBAAyB,CAAC,CAACC,KAAK,CAAC,SAAS,CAAC;EAC5D,CAAC,CAAC,MAAM;IACN,OAAO,KAAK;EACd;AACF;AAEA,eAAeC,kBAAkBA,CAACC,MAA4B,EAAmB;EAC/EC,kBAAM,CAACC,MAAM,CAACC,IAAI,CAAE,2BAA0BC,gBAAK,CAACC,IAAI,CAACL,MAAM,CAAC5B,IAAI,CAAE,EAAC,CAAC;;EAExE;EACA,MAAMkC,eAAe,GAAGC,wBAAa,CAACC,KAAK,CACzClD,aAAa,CAAC,CAAC,EACf,CACG,IAAG0C,MAAM,CAAC5B,IAAK;EAChB;EACA;EACA;EAAA,CACD,EACD;IACEqC,KAAK,EAAE,QAAQ;IACfC,QAAQ,EAAE;EACZ,CACF,CAAC;EAEDJ,eAAe,CAACK,KAAK,CAAC,CAAC;EAEvB,OAAO,IAAIC,OAAO,CAAS,CAACC,OAAO,EAAEC,MAAM,KAAK;IAC9C,MAAMC,SAAS,GAAGC,WAAW,CAAC,YAAY;MACxC,MAAMjC,aAAa,GAAG,MAAMC,uBAAuB,CAAC,CAAC;MACrD,MAAMiC,SAAS,GAAGlC,aAAa,CAACmC,IAAI,CAAC,CAAC;QAAE9C;MAAK,CAAC,KAAKA,IAAI,KAAK4B,MAAM,CAAC5B,IAAI,CAAC;MACxE,IAAI6C,SAAS,EAAE;QACb,MAAM3C,QAAQ,GAAG,MAAMmB,4BAA4B,CAACwB,SAAS,CAACvB,GAAG,CAAC;QAClE,IAAIpB,QAAQ,EAAE;UACZ6C,WAAW,CAAC,CAAC;UACbN,OAAO,CAACI,SAAS,CAAC;QACpB;MACF;IACF,CAAC,EAAE,IAAI,CAAC;;IAER;IACA,MAAMG,QAAQ,GAAGC,UAAU,CAAC,MAAM;MAChC,MAAMC,aAAa,GAAI,GAAEhE,aAAa,CAAC,CAAE,KAAI0C,MAAM,CAAC5B,IAAK,EAAC;MAC1DmD,oBAAoB,CACjB,mDAAkDvB,MAAM,CAAC5B,IAAK,wEAAuEkD,aAAc,EACtJ,CAAC;IACH,CAAC,EAAEjE,yBAAyB,CAAC;IAE7B,MAAM8D,WAAW,GAAGA,CAAA,KAAM;MACxBK,YAAY,CAACJ,QAAQ,CAAC;MACtBK,aAAa,CAACV,SAAS,CAAC;IAC1B,CAAC;IAED,MAAMQ,oBAAoB,GAAIG,OAAe,IAAK;MAChDP,WAAW,CAAC,CAAC;MACbL,MAAM,CAAC,IAAItB,KAAK,CAACkC,OAAO,CAAC,CAAC;MAC1BD,aAAa,CAACV,SAAS,CAAC;IAC1B,CAAC;IAEDT,eAAe,CAACqB,EAAE,CAAC,OAAO,EAAE,CAAC;MAAED;IAAQ,CAAC,KAAKH,oBAAoB,CAACG,OAAO,CAAC,CAAC;IAE3EpB,eAAe,CAACqB,EAAE,CAAC,MAAM,EAAE,MAAM;MAC/B,MAAML,aAAa,GAAI,GAAEhE,aAAa,CAAC,CAAE,KAAI0C,MAAM,CAAC5B,IAAK,EAAC;MAC1DmD,oBAAoB,CACjB,iBAAgBvB,MAAM,CAAC5B,IAAK,yGAAwGkD,aAAc,EACrJ,CAAC;IACH,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ;;AAEA;AACO,eAAetC,uBAAuBA,CAAA,EAAsB;EACjE,MAAM4C,MAAM,GAAG,MAAMhD,iBAAiB,CAAC,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;EAEzD,MAAMiD,UAAU,GAAGD,MAAM,CAACjD,IAAI,CAAC,CAAC,CAACmD,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAAChE,KAAK,CAACC,aAAE,CAACC,GAAG,CAAC;EACjE;EACA;EACA,MAAM+D,eAIH,GAAGF,UAAU,CACbG,KAAK,CAAC,CAAC,EAAEH,UAAU,CAACvC,MAAM,CAAC,CAC3BnB,GAAG,CAAC8D,IAAI,IAAI;IACX;IACA;IACA;IACA,MAAMtC,KAAK,GAAGsC,IAAI,CAACnE,KAAK,CAAC,GAAG,CAAC,CAACG,MAAM,CAACC,OAAO,CAAC;IAE7C,MAAMK,YAAY,GAAGoB,KAAK,CAAC,CAAC,CAAC,KAAK,cAAc;IAChD,MAAMtB,IAAI,GAAG4D,IAAI,CAAC9C,QAAQ,CAAC,UAAU,CAAC,GAAG,UAAU,GAAG,QAAQ;IAC9D,OAAO;MAAEQ,KAAK;MAAEtB,IAAI;MAAEE;IAAa,CAAC;EACtC,CAAC,CAAC,CACDN,MAAM,CAAC,CAAC;IAAE0B,KAAK,EAAE,CAACD,GAAG;EAAE,CAAC,KAAK,CAAC,CAACA,GAAG,CAAC;EAEtC,MAAMwC,cAAc,GAAGH,eAAe,CAAC5D,GAAG,CAAkB,MAAMwB,KAAK,IAAI;IACzE,MAAM;MACJtB,IAAI;MACJsB,KAAK,EAAE,CAACD,GAAG,EAAE,GAAGyC,UAAU,CAAC;MAC3B5D;IACF,CAAC,GAAGoB,KAAK;IAET,IAAIvB,IAAmB,GAAG,IAAI;IAE9B,IAAIC,IAAI,KAAK,QAAQ,EAAE;MACrB,IAAIE,YAAY,EAAE;QAChB;QACA;QACA,MAAM6D,SAAS,GAAGD,UAAU,CAACjB,IAAI,CAACf,IAAI,IAAIA,IAAI,CAAChB,QAAQ,CAAC,QAAQ,CAAC,CAAC;QAClE,IAAIiD,SAAS,EAAE;UACbhE,IAAI,GAAGgE,SAAS,CAACN,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC;QACxC;MACF;MACA;MACA,IAAI,CAAC1D,IAAI,EAAE;QACT;QACAA,IAAI,GAAI,UAASsB,GAAI,EAAC;MACxB;IACF,CAAC,MAAM;MAAA,IAAA2C,qBAAA;MACL;MACAjE,IAAI,IAAAiE,qBAAA,GAAI,MAAM7D,4BAA4B,CAACkB,GAAG,CAAC,cAAA2C,qBAAA,cAAAA,qBAAA,GAAK,EAAE;IACxD;IAEA,OAAO;MACL3C,GAAG;MACHtB,IAAI;MACJC,IAAI;MACJE,YAAY;MACZD,QAAQ,EAAE;IACZ,CAAC;EACH,CAAC,CAAC;EAEF,OAAOsC,OAAO,CAAC0B,GAAG,CAACJ,cAAc,CAAC;AACpC;AAEO,SAASK,mBAAmBA,CAAA,EAAY;EAC7C,OACEhF,OAAO,CAACiF,QAAQ,KAAK,QAAQ,IAAIjF,OAAO,CAACiF,QAAQ,KAAK,OAAO,IAAIjF,OAAO,CAACiF,QAAQ,KAAK,OAAO;AAEjG;AAEA,eAAeC,iBAAiBA,CAACC,GAAW,EAAoB;EAC9D,IAAI;IACF,MAAMC,MAAM,GAAG,MAAM,IAAA9E,qBAAU,EAAC6E,GAAG,EAAE,CAAC,cAAc,CAAC,CAAC;IACtD,MAAME,KAAK,GAAG,IAAAjE,eAAI,EAACgE,MAAM,CAACE,MAAM,CAAC,CAAC/E,KAAK,CAAC,OAAO,CAAC;IAChD,OAAO8E,KAAK,CAACzD,QAAQ,CAAC,+BAA+B,CAAC,KAAK,KAAK;EAClE,CAAC,CAAC,OAAO2D,CAAM,EAAE;IACf,IAAIC,YAAY,GAAG,IAAApE,eAAI,EAACmE,CAAC,CAACD,MAAM,IAAIC,CAAC,CAAClF,MAAM,CAAC;IAC7C,IAAImF,YAAY,CAACC,UAAU,CAAC9F,8BAA8B,CAAC,EAAE;MAC3D6F,YAAY,GAAGA,YAAY,CAACE,SAAS,CAAC/F,8BAA8B,CAACoC,MAAM,CAAC;IAC9E;IACAwD,CAAC,CAACpB,OAAO,GAAGqB,YAAY;IACxB,MAAMD,CAAC;EACT;AACF;AAEO,eAAelE,iBAAiBA,CAACsE,IAAc,EAAmB;EACvE,MAAMC,oBAAQ,CAACC,cAAc,CAAC,KAAK,CAAC;EACpC,MAAMV,GAAG,GAAGhF,QAAQ,CAAC,CAAC;EAEtB,IAAIT,WAAW,KAAK,IAAI,EAAE;IACxB,MAAMoG,cAAc,GAAG,MAAMZ,iBAAiB,CAACC,GAAG,CAAC;IACnDzF,WAAW,GAAGoG,cAAc,KAAK,KAAK;EACxC;EAEA,IAAIC,eAAG,CAACC,OAAO,CAAC,CAAC,EAAE;IACjBtD,kBAAM,CAACC,MAAM,CAACC,IAAI,CAAC,CAACuC,GAAG,EAAE,GAAGQ,IAAI,CAAC,CAACM,IAAI,CAAC,GAAG,CAAC,CAAC;EAC9C;EACA,IAAI;IACF,MAAMb,MAAM,GAAG,MAAM,IAAA9E,qBAAU,EAAC6E,GAAG,EAAEQ,IAAI,CAAC;IAC1C,OAAOP,MAAM,CAACf,MAAM,CAAC4B,IAAI,CAAC,IAAI,CAAC;EACjC,CAAC,CAAC,OAAOV,CAAM,EAAE;IACf;IACA,IAAIA,CAAC,CAACW,MAAM,KAAK,QAAQ,EAAE;MACzBX,CAAC,CAACY,YAAY,GAAG,IAAI;IACvB;IACA;IACA,IAAIX,YAAY,GAAG,CAACD,CAAC,CAACD,MAAM,IAAIC,CAAC,CAAClF,MAAM,IAAIkF,CAAC,CAACpB,OAAO,EAAE/C,IAAI,CAAC,CAAC;IAC7D,IAAIoE,YAAY,CAACC,UAAU,CAAC9F,8BAA8B,CAAC,EAAE;MAC3D6F,YAAY,GAAGA,YAAY,CAACE,SAAS,CAAC/F,8BAA8B,CAACoC,MAAM,CAAC;IAC9E;IACAwD,CAAC,CAACpB,OAAO,GAAGqB,YAAY;IACxB,MAAMD,CAAC;EACT;AACF;AAEO,eAAea,qBAAqBA,CAACT,IAAc,EAAEU,QAAmB,EAAE;EAC/E,MAAMT,oBAAQ,CAACC,cAAc,CAAC,KAAK,CAAC;EACpC,MAAMV,GAAG,GAAGhF,QAAQ,CAAC,CAAC;EAEtB,IAAIT,WAAW,KAAK,IAAI,EAAE;IACxB,MAAMoG,cAAc,GAAG,MAAMZ,iBAAiB,CAACC,GAAG,CAAC;IACnDzF,WAAW,GAAGoG,cAAc,KAAK,KAAK;EACxC;EAEA,IAAI;IACF,OAAO,MAAM,IAAAQ,6BAAY,EAACnB,GAAG,EAAEQ,IAAI,EAAE;MACnCU,QAAQ;MACRnD,KAAK,EAAE;IACT,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOqC,CAAM,EAAE;IACf,IAAIC,YAAY,GAAG,CAACD,CAAC,CAACD,MAAM,IAAIC,CAAC,CAAClF,MAAM,IAAIkF,CAAC,CAACpB,OAAO,EAAE/C,IAAI,CAAC,CAAC;IAC7D,IAAIoE,YAAY,CAACC,UAAU,CAAC9F,8BAA8B,CAAC,EAAE;MAC3D6F,YAAY,GAAGA,YAAY,CAACE,SAAS,CAAC/F,8BAA8B,CAACoC,MAAM,CAAC;IAC9E;IACAwD,CAAC,CAACpB,OAAO,GAAGqB,YAAY;IACxB,MAAMD,CAAC;EACT;AACF;AAEA,eAAegB,wBAAwBA,CAAC9D,MAAc,EAAoB;EACxE;EACA,OAAOA,MAAM,CAACzB,YAAY;AAC5B;AAEA,eAAewF,gBAAgBA,CAAC/D,MAAc,EAAEgE,cAAsB,EAAoB;EACxF,MAAMC,QAAQ,GAAG,MAAMrF,iBAAiB,CACtCsF,UAAU,CAAClE,MAAM,CAACN,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,MAAM,EAAE,UAAU,EAAEsE,cAAc,CAC1E,CAAC;EAED,MAAMpB,KAAK,GAAGqB,QAAQ,CAACnG,KAAK,CAAC,OAAO,CAAC;EACrC,KAAK,IAAIqG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGvB,KAAK,CAACtD,MAAM,EAAE6E,CAAC,EAAE,EAAE;IACrC,MAAMlC,IAAI,GAAGW,KAAK,CAACuB,CAAC,CAAC,CAACxF,IAAI,CAAC,CAAC;IAC5B,IAAIsD,IAAI,KAAM,WAAU+B,cAAe,EAAC,EAAE;MACxC,OAAO,IAAI;IACb;EACF;EACA,OAAO,KAAK;AACd;;AAEA;AACA,eAAeI,qBAAqBA,CAACpE,MAAc,EAAE;EACnD,OAAO,MAAM+D,gBAAgB,CAAC/D,MAAM,EAAE,mBAAmB,CAAC;AAC5D;AAEA,eAAeqE,6BAA6BA,CAACrE,MAAc,EAAEsE,aAAqB,EAAiB;EACjG,IAAI,EAAE,MAAMP,gBAAgB,CAAC/D,MAAM,EAAEsE,aAAa,CAAC,CAAC,EAAE;IACpD,MAAM,IAAI9E,KAAK,CACZ,2BAA0B8E,aAAc,uCAAsC,GAC5E,6DAA4D,IAAAC,qBAAS,EACpE,yDACF,CAAE,EACN,CAAC;EACH;AACF;AAEA,eAAeC,yBAAyBA,CAACxE,MAAc,EAAEsE,aAAqB,EAAoB;EAChG,OAAO,MAAMP,gBAAgB,CAAC/D,MAAM,EAAEsE,aAAa,CAAC;AACtD;AAEA,eAAeG,mBAAmBA,CAACzE,MAAc,EAA0B;EACzE,MAAMG,IAAI,GAAG,MAAMvB,iBAAiB,CAClCsF,UAAU,CAAClE,MAAM,CAACN,GAAG,EAAE,OAAO,EAAE,SAAS,EAAE,SAAS,EAAE,mBAAmB,CAC3E,CAAC;EAED,MAAMgF,KAAK,GAAG,uBAAuB;EACrC,MAAMC,UAAU,GAAGD,KAAK,CAACE,IAAI,CAACzE,IAAI,CAAC;EACnC,IAAI,CAACwE,UAAU,IAAIA,UAAU,CAACrF,MAAM,GAAG,CAAC,EAAE;IACxC,OAAO,IAAI;EACb;EAEA,OAAOqF,UAAU,CAAC,CAAC,CAAC;AACtB;AAEA,eAAeE,qBAAqBA,CAAC7E,MAAc,EAAE8E,UAAmB,EAAoB;EAAA,IAAAC,qBAAA;EAC1F,MAAMC,QAAQ,GAAG,MAAMC,oBAAQ,CAACC,aAAa,CAAC,CAAC;EAC/C,MAAMC,YAAY,GAAG,MAAMC,eAAe,CAACN,UAAU,CAAC;EACtD,MAAMO,mBAAmB,IAAAN,qBAAA,GAAGI,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAEG,OAAO,cAAAP,qBAAA,cAAAA,qBAAA,GAAIC,QAAQ,CAACO,cAAc;EAC5E,MAAMC,gBAAgB,GAAG,MAAMf,mBAAmB,CAACzE,MAAM,CAAC;EAC1D,OAAO,CAACwF,gBAAgB,IAAIC,iBAAM,CAACC,EAAE,CAACF,gBAAgB,EAAEH,mBAAmB,CAAC;AAC9E;AAEO,eAAeM,gBAAgBA,CAAC;EACrC3F,MAAM;EACN4F,GAAG;EACHN;AAKF,CAAC,EAAE;EACD,IAAIO,YAA4B;EAChC,MAAMC,eAAe,GAAGA,CAAA,KAAM;IAC5B,IAAID,YAAY,EAAE;MAChBrE,YAAY,CAACqE,YAAY,CAAC;IAC5B;IACA,OAAOxE,UAAU,CAAC,MAAM;MACtBpB,kBAAM,CAACC,MAAM,CAACC,IAAI,CAAC,EAAE,CAAC;MACtBF,kBAAM,CAACC,MAAM,CAACC,IAAI,CAChB,mIACF,CAAC;IACH,CAAC,EAAE/C,uBAAuB,CAAC;EAC7B,CAAC;EAED6C,kBAAM,CAAC8F,aAAa,CAAC5F,IAAI,CACvB;IAAE6F,IAAI,EAAEC,wBAAY,CAACC;EAAmB,CAAC,EACzC,mDACF,CAAC;EAEDL,YAAY,GAAGC,eAAe,CAAC,CAAC;EAChC,MAAMK,IAAI,GAAG,MAAM,IAAAC,4BAAgB,EAACR,GAAG,EAAES,QAAQ,IAAI;IACnDpG,kBAAM,CAAC8F,aAAa,CAAC5F,IAAI,CAAC;MAAE6F,IAAI,EAAEC,wBAAY,CAACK;IAAkB,CAAC,EAAED,QAAQ,CAAC;EAC/E,CAAC,CAAC;EAEFpG,kBAAM,CAAC8F,aAAa,CAAC5F,IAAI,CAAC;IAAE6F,IAAI,EAAEC,wBAAY,CAACM;EAAkB,CAAC,CAAC;EAEnE,MAAM7E,OAAO,GAAG4D,OAAO,GAClB,sBAAqBA,OAAQ,OAAMtF,MAAM,CAAC5B,IAAK,EAAC,GAChD,yBAAwB4B,MAAM,CAAC5B,IAAK,EAAC;EAE1C6B,kBAAM,CAAC8F,aAAa,CAAC5F,IAAI,CAAC;IAAE6F,IAAI,EAAEC,wBAAY,CAACO;EAAc,CAAC,EAAE9E,OAAO,CAAC;EACxEmE,YAAY,GAAGC,eAAe,CAAC,CAAC;EAChC,MAAMnD,MAAM,GAAG,MAAM8D,oBAAoB,CAACzG,MAAM,EAAE;IAAE0G,UAAU,EAAEP;EAAK,CAAC,CAAC;EACvElG,kBAAM,CAAC8F,aAAa,CAAC5F,IAAI,CAAC;IAAE6F,IAAI,EAAEC,wBAAY,CAACU;EAAa,CAAC,CAAC;EAE9DnF,YAAY,CAACqE,YAAY,CAAC;EAC1B,OAAOlD,MAAM;AACf;AAEO,eAAe8D,oBAAoBA,CACxCzG,MAA2B,EAC3B;EAAE0G;AAAmC,CAAC,EACtC;EACA,OAAO,MAAM9H,iBAAiB,CAACsF,UAAU,CAAClE,MAAM,CAACN,GAAG,EAAE,SAAS,EAAE,IAAI,EAAE,IAAI,EAAEgH,UAAU,CAAC,CAAC;AAC3F;AAEO,eAAeE,mBAAmBA,CAAC;EACxCxI;AACiB,CAAC,GAAG,CAAC,CAAC,EAA0B;EAAA,IAAAyI,aAAA;EACjD,MAAMC,OAAO,GAAG,MAAM9H,uBAAuB,CAAC,CAAC;EAE/C,IAAI,CAACZ,IAAI,EAAE;IAAA,IAAA2I,SAAA;IACT,QAAAA,SAAA,GAAOD,OAAO,CAAC,CAAC,CAAC,cAAAC,SAAA,cAAAA,SAAA,GAAI,IAAI;EAC3B;EAEA,QAAAF,aAAA,GAAOC,OAAO,CAAC5F,IAAI,CAAClB,MAAM,IAAIA,MAAM,CAAC5B,IAAI,KAAKA,IAAI,CAAC,cAAAyI,aAAA,cAAAA,aAAA,GAAI,IAAI;AAC7D;AAEO,eAAeG,kBAAkBA,CAAChH,MAAc,EAA+B;EACpFC,kBAAM,CAACC,MAAM,CAACC,IAAI,CAAC,2CAA2C,CAAC;;EAE/D;EACA,MAAM8G,WAAW,GAAG,MAAM7C,qBAAqB,CAACpE,MAAM,CAAC;EACvD,IAAI,CAACiH,WAAW,EAAE;IAChB;EACF;EAEA,IAAI;IACF,OAAO,MAAMrI,iBAAiB,CAACsF,UAAU,CAAClE,MAAM,CAACN,GAAG,EAAE,WAAW,EAAE,mBAAmB,CAAC,CAAC;EAC1F,CAAC,CAAC,OAAOoD,CAAM,EAAE;IACf7C,kBAAM,CAACC,MAAM,CAACgH,KAAK,CACjB,gGACF,CAAC;IACD,MAAMpE,CAAC;EACT;AACF;AAEO,eAAeqE,gBAAgBA,CAAC;EACrCvB,GAAG;EACHN,OAAO;EACPtF;AAKF,CAAC,GAAG,CAAC,CAAC,EAAoB;EACxB,IAAI;IACF,IAAI,CAACA,MAAM,EAAE;MACXA,MAAM,GAAG,CAAC,MAAMhB,uBAAuB,CAAC,CAAC,EAAE,CAAC,CAAC;MAC7C,IAAI,CAACgB,MAAM,EAAE;QACX,MAAM,IAAIR,KAAK,CAAC,sBAAsB,CAAC;MACzC;IACF;IACAQ,MAAM,GAAG,MAAMoH,mCAAmC,CAACpH,MAAM,CAAC;IAC1D,IAAI,CAACA,MAAM,EAAE;MACX,OAAO,KAAK;IACd;IAEA,MAAMgH,kBAAkB,CAAChH,MAAM,CAAC;IAChC,MAAM2F,gBAAgB,CAAC;MAAE3F,MAAM;MAAE4F,GAAG;MAAEN;IAAQ,CAAC,CAAC;IAChD,IAAItI,QAAQ,EAAE;MACZiD,kBAAM,CAACC,MAAM,CAACC,IAAI,CAAE,kBAAiBnD,QAAS,WAAU,CAAC;MACzD,MAAM4B,iBAAiB,CAAC,CACtB,OAAO,EACP,IAAI,EACJ,OAAO,EACP,IAAI,EACJ,4BAA4B,EAC5B,IAAI,EACJ5B,QAAQ,CACT,CAAC;MACFA,QAAQ,GAAG,IAAI;IACjB;IAEA,OAAO,IAAI;EACb,CAAC,CAAC,OAAO8F,CAAM,EAAE;IACf7C,kBAAM,CAACC,MAAM,CAACgH,KAAK,CAACpE,CAAC,CAACpB,OAAO,CAAC;IAC9B,OAAO,KAAK;EACd;AACF;AAEA,eAAe2F,aAAaA,CAAC;EAC3B3H,GAAG;EACHkG,GAAG;EACHtB;AAKF,CAAC,EAAE;EACD;EACA;EACA;EACA;EACA;EACA,IAAIA,aAAa,KAAK,mBAAmB,EAAE;IACzC,MAAMgD,UAAU,GAAG,MAAM1I,iBAAiB,CACxCsF,UAAU,CACRxE,GAAG,EACH,OAAO,EACP,QAAQ,EACR,IAAI,EACJ4E,aAAa,EACb,IAAI,EACJ,kCAAkC,EAClC,GACF,CACF,CAAC;IACD,IAAIgD,UAAU,CAACnI,QAAQ,CAAChC,yBAAyB,CAAC,EAAE;MAClD,MAAM,IAAIqC,KAAK,CAAC8H,UAAU,CAACrE,SAAS,CAACqE,UAAU,CAACC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;IACtE;EACF;EAEA,MAAMC,WAAW,GAAG,MAAM5I,iBAAiB,CACzCsF,UAAU,CAACxE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,4BAA4B,EAAE,IAAI,EAAEkG,GAAG,CACvF,CAAC;EACD,IAAI4B,WAAW,CAACrI,QAAQ,CAAChC,yBAAyB,CAAC,EAAE;IACnD,MAAM,IAAIqC,KAAK,CAACgI,WAAW,CAACvE,SAAS,CAACuE,WAAW,CAACD,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;EACxE;EAEA,OAAOC,WAAW;AACpB;AAEA,SAASC,UAAUA,CAACC,IAAqB,EAAE;EACzC,OAAO,IAAA7D,6BAAY,EAAC,MAAM,EAAE,CAAE,MAAK6D,IAAK,EAAC,EAAE,IAAI,EAAE,IAAI,EAAE,cAAc,CAAC,EAAE;IACtE9D,QAAQ,EAAE,MAAM;IAChBnD,KAAK,EAAE,CAAC,MAAM,EAAE,MAAM,EAAE,QAAQ;EAClC,CAAC,CAAC,CACC3C,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CACda,IAAI,CAAC,CAAC;AACX;AAEO,eAAegJ,2BAA2BA,CAAC3H,MAAoC,EAAE;EAAA,IAAA4H,MAAA;EACtF;EACE;EACArK,OAAO,CAACiF,QAAQ,KAAK,QAAQ;EAC7B;EACAxC,MAAM,CAAC3B,IAAI,KAAK,UAAU,EAC1B;IACA;EACF;;EAEA;EACA,MAAMwJ,UAAU,IAAAD,MAAA,GAAG5H,MAAM,CAACN,GAAG,CAAEI,KAAK,CAAC,QAAQ,CAAC,cAAA8H,MAAA,uBAA3BA,MAAA,CAA8B,CAAC,CAAC;EACnD,IAAI,CAACC,UAAU,EAAE;IACf;EACF;EACA;EACA,MAAMnI,GAAG,GAAG+H,UAAU,CAACI,UAAU,CAAC;EAElC,IAAI;IACF,MAAM9M,SAAS,CAAD,CAAC,CAAC+M,SAAS,CAAE;AAC/B;AACA,0DAA0DpI,GAAI;AAC9D,WAAW,CAAC;EACV,CAAC,CAAC,MAAM;IACN;EAAA;AAEJ;;AAEA;AACA;AACA;AACA;AACO,eAAeqI,YAAYA,CAChC/H,MAAoC,EACpC;EACEgI;AAGF,CAAC,EACD;EACA,MAAMR,WAAW,GAAG,MAAM5I,iBAAiB,CACzCsF,UAAU,CACRlE,MAAM,CAACN,GAAG,EACV,OAAO,EACP,IAAI,EACJ,OAAO,EACP,IAAI,EACJ,2BAA2B;EAC3B;EACA,IAAI,EACJ,YAAY;EACZ;EACA,IAAI,EACJsI,cACF,CACF,CAAC;;EAED;EACA,IAAIR,WAAW,CAAC1H,KAAK,CAAC,2CAA2C,CAAC,EAAE;IAClE,MAAM,KAAImI,oBAAQ,EAAC,mBAAmB,EAAET,WAAW,CAACvE,SAAS,CAACuE,WAAW,CAACD,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;EAChG;EAEA,MAAMI,2BAA2B,CAAC3H,MAAM,CAAC;EAEzC,OAAOwH,WAAW;AACpB;AAEO,eAAeJ,mCAAmCA,CAACpH,MAAc,EAA0B;EAChG;;EAEA,IAAI,EAAE,MAAM4G,mBAAmB,CAAC5G,MAAM,CAAC,CAAC,EAAE;IACxCA,MAAM,GAAG,MAAMD,kBAAkB,CAACC,MAAM,CAAC;EAC3C;EAEA,IAAI,EAAE,MAAM8D,wBAAwB,CAAC9D,MAAM,CAAC,CAAC,EAAE;IAC7CkI,eAAe,CAAClI,MAAM,CAAC;IACvB,OAAO,IAAI;EACb;EAEA,OAAOA,MAAM;AACf;AAEA,SAASkI,eAAeA,CAAClI,MAAc,EAAE;EACvCC,kBAAM,CAACC,MAAM,CAACiI,IAAI,CACf,uDAAsD/H,gBAAK,CAACC,IAAI,CAACL,MAAM,CAAC5B,IAAI,CAAE,KAAIgC,gBAAK,CAACgI,GAAG,CAC1F,IAAA7D,qBAAS,EAAC,2CAA2C,CACvD,CAAE,EACJ,CAAC;AACH;;AAEA;AACA;AACA,MAAM8D,oBAA6C,GAAG,CAAC,CAAC;AAExD,eAAeC,qBAAqBA,CAACC,WAAmB,EAAE;EACxD,IAAI;IACF,MAAMC,8BAAa,CAACC,KAAK,CAACC,0BAA0B,CAACH,WAAW,CAAC;IACjE,OAAO,KAAK;EACd,CAAC,CAAC,MAAM;IACN,OAAO,IAAI;EACb;AACF;AAEA,eAAeI,YAAYA,CAAC;EAC1B/C,GAAG;EACH5F,MAAM;EACN4I,UAAU,GAAG,KAAK;EAClB9D,UAAU;EACV+D,SAAS,GAAG,KAAK;EACjBC,GAAG;EACHP;AASF,CAAC,EAAiB;EAChB,MAAMQ,YAAY,GAAG,MAAM3B,mCAAmC,CAACpH,MAAM,CAAC;EACtE,IAAI,CAAC+I,YAAY,EAAE;IACjB;EACF;EACA9I,kBAAM,CAACC,MAAM,CAACC,IAAI,CAAE,kBAAiBC,gBAAK,CAAC4I,SAAS,CAACpD,GAAG,CAAE,OAAMxF,gBAAK,CAACC,IAAI,CAAC0I,YAAY,CAAC3K,IAAI,CAAE,EAAC,CAAC;EAEhG,MAAMuJ,2BAA2B,CAACoB,YAAY,CAAC;EAE/C/I,MAAM,GAAG+I,YAAY;EACrB,IAAIE,aAAa,GAAG,KAAK;EACzB,IAAIC,mBAAmB,GAAG,mBAAmB;EAE7C,MAAMC,mBAAmB,GAAG,MAAOnJ,MAAc,IAAK;IAAA,IAAAoJ,WAAA;IACpD,IAAIC,aAAa,GAAG,EAAE,MAAMjF,qBAAqB,CAACpE,MAAM,CAAC,CAAC;IAC1D,MAAMsJ,SAAS,IAAAF,WAAA,GAAGpJ,MAAM,CAACN,GAAG,cAAA0J,WAAA,cAAAA,WAAA,GAAI,SAAS;IACzC,IACE,CAACC,aAAa,IACd,CAAChB,oBAAoB,CAACiB,SAAS,CAAC,KAC/B,MAAMzE,qBAAqB,CAAC7E,MAAM,EAAE8E,UAAU,CAAC,CAAC,EACjD;MACA;MACAuD,oBAAoB,CAACiB,SAAS,CAAC,GAAG,IAAI;MACtC,MAAMC,OAAO,GAAG,MAAMC,mBAAO,CAACC,YAAY,CAAC;QACzCC,OAAO,EAAE,IAAI;QACbhI,OAAO,EAAG,cAAa1B,MAAM,CAAC5B,IAAK,KAAI4B,MAAM,CAAC3B,IAAK;MACrD,CAAC,CAAC;MACF,IAAIkL,OAAO,EAAE;QACX,MAAMvC,kBAAkB,CAAChH,MAAM,CAAC;QAChCqJ,aAAa,GAAG,IAAI;MACtB;IACF;IAEA,IAAIA,aAAa,EAAE;MACjB,MAAMM,aAAa,GAAG,MAAMvE,eAAe,CAACN,UAAU,CAAC;MACvD,MAAMa,gBAAgB,CAAC;QAAE3F,MAAM;QAAE,GAAG2J;MAAc,CAAC,CAAC;MACpDV,aAAa,GAAG,IAAI;IACtB;EACF,CAAC;EAED,MAAMW,sBAAsB,GAAG,MAAAA,CAAA,KAAY;IACzC,IAAItF,aAAa;IACjB,MAAMuF,SAAS,GAAG,MAAMvB,qBAAqB,CAACC,WAAW,CAAC;IAC1D,IAAIsB,SAAS,EAAE;MAAA,IAAAC,YAAA;MACbxF,aAAa,GAAGwE,GAAG,aAAHA,GAAG,wBAAAgB,YAAA,GAAHhB,GAAG,CAAEiB,OAAO,cAAAD,YAAA,uBAAZA,YAAA,CAAcE,OAAO;MACrC,IAAI,CAAC1F,aAAa,EAAE;QAClB,MAAM,IAAI9E,KAAK,CACZ,gHACH,CAAC;MACH;IACF,CAAC,MAAM;MACL8E,aAAa,GAAG,MAAM2F,yBAAyB,CAAC1B,WAAW,CAAC;MAC5D,IAAI,CAACjE,aAAa,EAAE;QAClB,MAAM,IAAI9E,KAAK,CACZ,mCAAkCgJ,8BAAa,CAACC,KAAK,CAACyB,yBAAyB,CAC9E3B,WACF,CAAE,EACJ,CAAC;MACH;IACF;IACA,OAAOjE,aAAa;EACtB,CAAC;EAED,IAAI;IACF,IAAIuE,SAAS,EAAE;MACbK,mBAAmB,GAAG,MAAMU,sBAAsB,CAAC,CAAC;MACpD,MAAMvF,6BAA6B,CAACrE,MAAM,EAAEkJ,mBAAmB,CAAC;IAClE,CAAC,MAAM,IACL5F,eAAG,CAAC6G,yBAAyB,CAAC,CAAC,IAC/B,CAACtB,SAAS,IACV,IAAAuB,uCAA2B,EAAC7B,WAAW,CAAC,EACxC;MACA,MAAMY,mBAAmB,CAACnJ,MAAM,CAAC;MAEjC,IAAIsE,aAAiC;MACrC,IAAI;QACFA,aAAa,GAAG,MAAMsF,sBAAsB,CAAC,CAAC;MAChD,CAAC,CAAC,OAAO9G,CAAM,EAAE;QACf7C,kBAAM,CAACC,MAAM,CAACiI,IAAI,CAACrF,CAAC,CAAC;MACvB;MAEA,MAAMuH,oBAAoB,GAAG/F,aAAa,GACtC,MAAME,yBAAyB,CAACxE,MAAM,EAAEsE,aAAa,CAAC,GACtD,KAAK;MAET,IAAI+F,oBAAoB,EAAE;QACxB;QACAnB,mBAAmB,GAAG,EAAE,CAAC,CAAC;MAC5B,CAAC,MAAM;QACL;QACAjJ,kBAAM,CAACC,MAAM,CAACiI,IAAI,CACf,4NAA2N,IAAA5D,qBAAS,EACnO,0CACF,CAAE,EACJ,CAAC;QAED,MAAM+F,aAAa,GAAG,MAAMC,sBAAsB,CAAChC,WAAW,EAAEiC,SAAS,EAAE,KAAK,EAAE,KAAK,CAAC;QACxF,IAAI,CAACF,aAAa,EAAE;UAClB;UACA,MAAM9K,KAAK,CAAC,kDAAkD,CAAC;QACjE;QACAoG,GAAG,GAAG0E,aAAa;QACnBrK,kBAAM,CAACC,MAAM,CAACuK,KAAK,CAAE,oBAAmB7E,GAAI,EAAC,CAAC;QAC9C5I,QAAQ,GAAG4I,GAAG;MAChB;IACF,CAAC,MAAM,IAAI,CAACgD,UAAU,EAAE;MACtB,MAAMO,mBAAmB,CAACnJ,MAAM,CAAC;MACjChD,QAAQ,GAAG4I,GAAG;MACd;IACF;;IAEA,IAAI;MACF,MAAMyB,aAAa,CAAC;QAAE3H,GAAG,EAAEM,MAAM,CAACN,GAAI;QAAEkG,GAAG;QAAEtB,aAAa,EAAE4E;MAAoB,CAAC,CAAC;IACpF,CAAC,CAAC,OAAOpG,CAAM,EAAE;MACf,IAAI8F,UAAU,EAAE;QACd9F,CAAC,CAACpB,OAAO,GAAI,+HAA8HoB,CAAC,CAACpB,OAAQ,EAAC;MACxJ,CAAC,MAAM;QACLoB,CAAC,CAACpB,OAAO,GAAI,sBAAqBoB,CAAC,CAACpB,OAAQ,EAAC;MAC/C;MAEA,MAAMoB,CAAC;IACT;IAEA,IAAI9C,MAAM,CAAC3B,IAAI,KAAK,UAAU,EAAE;MAC9B;IAAA;IAGFqM,qBAAS,CAACC,QAAQ,CAAC,oBAAoB,EAAE;MACvCnI,QAAQ,EAAE,SAAS;MACnByG;IACF,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOnG,CAAM,EAAE;IACfA,CAAC,CAACpB,OAAO,GAAI,sBAAqBoB,CAAC,CAACpB,OAAQ,EAAC;IAC7C,MAAMoB,CAAC;EACT;AACF;AAEA,eAAesC,eAAeA,CAACwF,gBAAyB,EAAE;EACxD,IAAI,CAACA,gBAAgB,EAAE;IACrB,OAAO,IAAI;EACb;EAEA,MAAM9F,UAAU,GAAG,CAAC,MAAMG,oBAAQ,CAAC4F,gBAAgB,CAAC,CAAC,EAAED,gBAAgB,CAAC;EACxE,IAAI,CAAC9F,UAAU,EAAE;IACf,OAAO,IAAI;EACb;EAEA,OAAO;IACLc,GAAG,EAAEd,UAAU,CAACgG,gBAAgB;IAChCxF,OAAO,EAAER,UAAU,CAACiG;EACtB,CAAC;AACH;AAEO,eAAed,yBAAyBA,CAAC1B,WAAmB,EAA0B;EAAA,IAAAyC,oBAAA,EAAAC,aAAA;EAC3F,IAAI;IACF,MAAMC,uBAAuB,GAAG,MAAM1C,8BAAa,CAAC2C,OAAO,CAACC,qBAAqB,CAAC7C,WAAW,CAAC;IAC9F,IAAI2C,uBAAuB,EAAE;MAC3B,OAAOA,uBAAuB;IAChC;EACF,CAAC,CAAC,MAAM,CAAC;EAET,IAAI;IAAA,IAAAG,qBAAA,EAAAC,sBAAA;IACF,MAAMC,QAAQ,GAAG,MAAM/C,8BAAa,CAACC,KAAK,CAAC+C,uBAAuB,CAACjD,WAAW,CAAC;IAC/E,MAAMkD,eAAe,GAAG,MAAMjD,8BAAa,CAACkD,QAAQ,CAACC,wBAAwB,CAACJ,QAAQ,CAAC;IACvF;IACA,MAAM/C,8BAAa,CAACkD,QAAQ,CAACE,sBAAsB,CAACH,eAAe,CAAC;IACpE,KAAAJ,qBAAA,GAAII,eAAe,CAACI,QAAQ,cAAAR,qBAAA,gBAAAC,sBAAA,GAAxBD,qBAAA,CAA0BS,CAAC,cAAAR,sBAAA,eAA3BA,sBAAA,CAA6BtB,OAAO,EAAE;MACxC,OAAOyB,eAAe,CAACI,QAAQ,CAACC,CAAC,CAAC9B,OAAO;IAC3C;EACF,CAAC,CAAC,MAAM,CAAC;EAET,MAAM;IAAElB;EAAI,CAAC,GAAG,IAAAiD,mBAAS,EAACxD,WAAW,EAAE;IAAEyD,yBAAyB,EAAE;EAAK,CAAC,CAAC;EAC3E,QAAAhB,oBAAA,IAAAC,aAAA,GAAOnC,GAAG,CAACiB,OAAO,cAAAkB,aAAA,uBAAXA,aAAA,CAAajB,OAAO,cAAAgB,oBAAA,cAAAA,oBAAA,GAAI,IAAI;AACrC;AAEA,eAAeT,sBAAsBA,CACnChC,WAAmB,EACnB0D,MAAe,EACfpD,SAAmB,EACnBqD,8BAAuC,GAAG,IAAI,EACtB;EACxB,IACE5I,eAAG,CAAC6G,yBAAyB,CAAC,CAAC,IAC/B,CAACtB,SAAS,IACV,IAAAuB,uCAA2B,EAAC7B,WAAW,CAAC,IACxC2D,8BAA8B,EAC9B;IACA,OAAOC,oBAAQ,CAACC,wBAAwB,CAAC7D,WAAW,EAAE,SAAS,CAAC;EAClE,CAAC,MAAM;IACL,OAAO,MAAM4D,oBAAQ,CAAC5B,sBAAsB,CAAChC,WAAW,EAAE;MACxD0D;IACF,CAAC,CAAC,CAACI,KAAK,CAACvJ,CAAC,IAAI;MACZ,IAAI+F,SAAS,EAAE;QACb,OAAO,IAAI;MACb;MACA,MAAM/F,CAAC;IACT,CAAC,CAAC;EACJ;AACF;AAEO,eAAewJ,gBAAgBA,CAAC;EACrC/D,WAAW;EACXgE,YAAY;EACZ1D,SAAS,GAAG,KAAK;EACjB7I,MAAM;EACNiM,MAAM;EACN3H,aAAa;EACb0D;AASF,CAAC,EAAuF;EACtF,MAAMwE,oBAAoB,CAACjE,WAAW,CAAC;EAEvC,MAAMkE,UAAU,GAAG,MAAMlC,sBAAsB,CAAChC,WAAW,EAAE0D,MAAM,EAAEpD,SAAS,CAAC;EAE/E,MAAM;IAAEC;EAAI,CAAC,GAAG,IAAAiD,mBAAS,EAACxD,WAAW,EAAE;IACrCyD,yBAAyB,EAAE;EAC7B,CAAC,CAAC;;EAEF;EACA,IAAIhM,MAAM,EAAE;IACV,MAAM0M,MAAM,GAAG,MAAMtF,mCAAmC,CAACpH,MAAM,CAAC;IAChE,IAAI,CAAC0M,MAAM,EAAE;MACX,OAAO;QAAEC,OAAO,EAAE,KAAK;QAAEzF,KAAK,EAAE;MAAU,CAAC;IAC7C;IACAlH,MAAM,GAAG0M,MAAM;EACjB,CAAC,MAAM;IACL,MAAM5F,OAAO,GAAG,MAAMhI,2BAA2B,CAAC,CAAC;IACnD,IAAI4N,MAAqB,GAAG5F,OAAO,CAAC,CAAC,CAAC;IACtC,IAAIyF,YAAY,EAAE;MAChBG,MAAM,GAAG,MAAME,oBAAoB,CAAC9F,OAAO,CAAC;IAC9C;IACA,IAAI,CAAC4F,MAAM,EAAE;MACX,OAAO;QAAEC,OAAO,EAAE,KAAK;QAAEzF,KAAK,EAAE;MAAU,CAAC;IAC7C;IACAlH,MAAM,GAAG0M,MAAM;EACjB;;EAEA;EACA,IAAI,CAACD,UAAU,EAAE;IACf,IAAI,CAACzE,cAAc,EAAE;MAAA,IAAA6E,cAAA;MACnBvI,aAAa,IAAAuI,cAAA,GAAGvI,aAAa,cAAAuI,cAAA,cAAAA,cAAA,GAAK,MAAM5C,yBAAyB,CAAC1B,WAAW,CAAE;MAC/E,IAAI,CAACjE,aAAa,EAAE;QAClB,OAAO;UACLqI,OAAO,EAAE,KAAK;UACdzF,KAAK,EACH;QACJ,CAAC;MACH;MACAc,cAAc,GAAI,GAAE1D,aAAc,gBAAe;IACnD;IAEA,IAAI;MACF,MAAMyD,YAAY,CAAC/H,MAAM,EAAE;QACzBgI;MACF,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOd,KAAU,EAAE;MACnB,IAAInE,YAAY,GAAI,4CAA2CiF,cAAe,gBAAehI,MAAM,CAAC5B,IAAK,IAAG;MAC5G,IAAI8I,KAAK,YAAYe,oBAAQ,IAAIf,KAAK,CAAClB,IAAI,KAAK,mBAAmB,EAAE;QACnEjD,YAAY,IAAK,6DAA4D3C,gBAAK,CAACC,IAAI,CACpF,uBAAsBL,MAAM,CAAC5B,IAAK,EACrC,CAAE,EAAC;MACL;MACA2E,YAAY,IAAI3C,gBAAK,CAAC0M,IAAI,CAAE,KAAI5F,KAAK,CAACxF,OAAQ,EAAC,CAAC;MAChDwF,KAAK,CAACxF,OAAO,GAAGqB,YAAY;MAC5B,OAAO;QAAE4J,OAAO,EAAE,KAAK;QAAEzF;MAAM,CAAC;IAClC;IACA,OAAO;MACLyF,OAAO,EAAE,IAAI;MACb;MACA/G,GAAG,EAAE;IACP,CAAC;EACH;EAEA,IAAI;IACF,MAAM+C,YAAY,CAAC;MACjB/C,GAAG,EAAE6G,UAAU;MACfzM,MAAM;MACN4I,UAAU,EAAE,CAAC,CAACE,GAAG,CAACF,UAAU;MAC5B9D,UAAU,EAAEgE,GAAG,CAAChE,UAAU;MAC1B+D,SAAS;MACTC,GAAG;MACHP;IACF,CAAC,CAAC;IACF,OAAO;MAAEoE,OAAO,EAAE,IAAI;MAAE/G,GAAG,EAAE6G;IAAW,CAAC;EAC3C,CAAC,CAAC,OAAO3J,CAAM,EAAE;IACf,IAAIA,CAAC,CAACY,YAAY,EAAE;MAClB;MACA,OAAO;QAAEiJ,OAAO,EAAE,KAAK;QAAEzF,KAAK,EAAE;MAAU,CAAC;IAC7C,CAAC,MAAM;MACLpE,CAAC,CAACpB,OAAO,GAAI,sCAAqCoB,CAAC,CAACpB,OAAQ,EAAC;IAC/D;IACA,OAAO;MAAEiL,OAAO,EAAE,KAAK;MAAEzF,KAAK,EAAEpE;IAAE,CAAC;EACrC;AACF;AAEO,eAAeiK,mBAAmBA,CAAC;EACxCxE,WAAW;EACXgE;AAIF,CAAC,EAA+E;EAC9E,IAAI;IACF,MAAMC,oBAAoB,CAACjE,WAAW,CAAC;IAEvC,MAAMkE,UAAU,GAAG,MAAMO,mBAAO,CAACC,WAAW,CAAC1E,WAAW,CAAC;IACzD,IAAIkE,UAAU,KAAK,IAAI,EAAE;MACvB,OAAO;QACLE,OAAO,EAAE,KAAK;QACdzF,KAAK,EAAG;MACV,CAAC;IACH;IACA,MAAMJ,OAAO,GAAG,MAAMhI,2BAA2B,CAAC,CAAC;IACnD,IAAIkB,MAAqB,GAAG8G,OAAO,CAAC,CAAC,CAAC;IACtC,IAAIyF,YAAY,EAAE;MAChBvM,MAAM,GAAG,MAAM4M,oBAAoB,CAAC9F,OAAO,CAAC;IAC9C;IACA,IAAI,CAAC9G,MAAM,EAAE;MACX,OAAO;QAAE2M,OAAO,EAAE,KAAK;QAAEzF,KAAK,EAAE;MAAU,CAAC;IAC7C;IAEA,MAAMyB,YAAY,CAAC;MAAE/C,GAAG,EAAE6G,UAAU;MAAEzM,MAAM;MAAE4I,UAAU,EAAE,IAAI;MAAEL;IAAY,CAAC,CAAC;IAC9E,OAAO;MAAEoE,OAAO,EAAE,IAAI;MAAE/G,GAAG,EAAE6G;IAAW,CAAC;EAC3C,CAAC,CAAC,OAAO3J,CAAM,EAAE;IACf,OAAO;MAAE6J,OAAO,EAAE,KAAK;MAAEzF,KAAK,EAAG,6CAA4CpE,CAAC,CAACpB,OAAQ;IAAE,CAAC;EAC5F;AACF;;AAEA;AACO,eAAe8K,oBAAoBA,CAACjE,WAAmB,EAAoB;EAChF,MAAM2E,YAAY,GAAG,MAAMC,2BAAe,CAACC,qBAAqB,CAAC7E,WAAW,CAAC;EAC7E,MAAM8E,KAAK,GAAG,MAAM,IAAAC,wBAAc,EAAC/E,WAAW,CAAC;EAC/C,MAAMgF,0BAA0B,GAAGF,KAAK,CAACG,oBAAoB,IAAI,EAAE;EAEnE,MAAMC,eAAe,GAAG,CACtBP,YAAY,CAACQ,YAAY,EACzBR,YAAY,CAACS,cAAc,EAC3B,GAAGJ,0BAA0B,CAC9B,CAACtP,MAAM,CAACC,OAAO,CAAC;EAEjB,MAAM4I,OAAO,GAAG,MAAM9H,uBAAuB,CAAC,CAAC;EAC/C,KAAK,MAAMgB,MAAM,IAAI8G,OAAO,EAAE;IAC5B,KAAK,MAAMY,IAAI,IAAI+F,eAAe,EAAE;MAClC,IAAI,EAAE,MAAMG,UAAU,CAAC;QAAE5N,MAAM;QAAE0H;MAAK,CAAC,CAAC,CAAC,EAAE;QACzC,OAAO,KAAK;MACd;IACF;EACF;EAEA,OAAO,IAAI;AACb;AAEO,eAAemG,mBAAmBA,CAACtF,WAAmB,EAAiB;EAC5E,MAAM2E,YAAY,GAAG,MAAMC,2BAAe,CAACC,qBAAqB,CAAC7E,WAAW,CAAC;EAC7E,MAAM8E,KAAK,GAAG,MAAM,IAAAC,wBAAc,EAAC/E,WAAW,CAAC;EAC/C,MAAMgF,0BAA0B,GAAGF,KAAK,CAACG,oBAAoB,IAAI,EAAE;EAEnE,MAAMC,eAAe,GAAG,CACtBP,YAAY,CAACQ,YAAY,EACzBR,YAAY,CAACS,cAAc,EAC3B,GAAGJ,0BAA0B,CAC9B,CAACtP,MAAM,CAACC,OAAO,CAAC;EAEjB,MAAM4I,OAAO,GAAG,MAAM9H,uBAAuB,CAAC,CAAC;EAC/C,KAAK,MAAMgB,MAAM,IAAI8G,OAAO,EAAE;IAC5B,KAAK,MAAMY,IAAI,IAAI+F,eAAe,EAAE;MAClC,MAAMK,gBAAgB,CAAC;QAAE9N,MAAM;QAAE0H;MAAK,CAAC,CAAC;IAC1C;EACF;AACF;AAEA,eAAekG,UAAUA,CAAC;EAAE5N,MAAM;EAAE0H;AAAuC,CAAC,EAAoB;EAC9F,IAAI,EAAE,MAAM5D,wBAAwB,CAAC9D,MAAM,CAAC,CAAC,EAAE;IAC7C,OAAO,KAAK;EACd;EAEA,IAAI;IACF,MAAMpB,iBAAiB,CAACsF,UAAU,CAAClE,MAAM,CAACN,GAAG,EAAE,SAAS,EAAG,OAAMgI,IAAK,EAAC,EAAG,OAAMA,IAAK,EAAC,CAAC,CAAC;IACxF,OAAO,IAAI;EACb,CAAC,CAAC,OAAO5E,CAAM,EAAE;IACf7C,kBAAM,CAACC,MAAM,CAACiI,IAAI,CAAE,yBAAwBrF,CAAC,CAACpB,OAAQ,EAAC,CAAC;IACxD,OAAO,KAAK;EACd;AACF;AAEA,eAAeoM,gBAAgBA,CAAC;EAC9B9N,MAAM;EACN0H;AAIF,CAAC,EAAoB;EACnB,IAAI,EAAE,MAAM5D,wBAAwB,CAAC9D,MAAM,CAAC,CAAC,EAAE;IAC7C,OAAO,KAAK;EACd;EAEA,IAAI;IACF,MAAMpB,iBAAiB,CAACsF,UAAU,CAAClE,MAAM,CAACN,GAAG,EAAE,SAAS,EAAE,UAAU,EAAG,OAAMgI,IAAK,EAAC,CAAC,CAAC;IACrF,OAAO,IAAI;EACb,CAAC,CAAC,OAAO5E,CAAM,EAAE;IACf;IACA7C,kBAAM,CAACC,MAAM,CAACuK,KAAK,CAAE,gCAA+B3H,CAAC,CAACpB,OAAQ,EAAC,CAAC;IAChE,OAAO,KAAK;EACd;AACF;AAEA,SAASwC,UAAUA,CAACxE,GAAkB,EAAE,GAAGqO,OAAiB,EAAY;EACtE,MAAM7K,IAAI,GAAG,EAAE;EACf,IAAIxD,GAAG,EAAE;IACPwD,IAAI,CAAC8K,IAAI,CAAC,IAAI,EAAEtO,GAAG,CAAC;EACtB;EACA,OAAOwD,IAAI,CAAC7D,MAAM,CAAC0O,OAAO,CAAC;AAC7B;AAOA,MAAME,0BAAoD,GAAG,CAC3D;EACEC,GAAG,EAAE,MAAM;EACXC,cAAc,EAAE;AAClB,CAAC,EACD;EACED,GAAG,EAAE,MAAM;EACXC,cAAc,EAAE;AAClB,CAAC,EACD;EACED,GAAG,EAAE,OAAO;EACZC,cAAc,EAAE;AAClB,CAAC,EACD;EACED,GAAG,EAAE,QAAQ;EACbC,cAAc,EAAE;AAClB,CAAC,EACD;EACED,GAAG,EAAE,SAAS;EACdC,cAAc,EAAE;AAClB,CAAC,CACF;;AAED;AACA;AACA;AACA;AACA;AACA;AACO,eAAeC,uBAAuBA,CAAC7F,WAAmB,EAAiB;EAAA,IAAA8F,IAAA,EAAAC,qBAAA,EAAAC,aAAA,EAAAC,oBAAA,EAAAC,WAAA,EAAAC,YAAA,EAAAC,aAAA;EAChF,MAAM;IAAE7F;EAAI,CAAC,GAAG,IAAAiD,mBAAS,EAACxD,WAAW,CAAC;;EAEtC;EACA,IAAI,CAACtD,oBAAQ,CAAC2J,aAAa,CAAC9F,GAAG,EAAE,QAAQ,CAAC,EAAE;IAC1C;EACF;EAEA,MAAM+F,gBAAgB,IAAAR,IAAA,IAAAC,qBAAA,IAAAC,aAAA,GAAGzF,GAAG,CAACiB,OAAO,cAAAwE,aAAA,wBAAAC,oBAAA,GAAXD,aAAA,CAAaO,MAAM,cAAAN,oBAAA,uBAAnBA,oBAAA,CAAqBO,UAAU,cAAAT,qBAAA,cAAAA,qBAAA,IAAAG,WAAA,GAAI3F,GAAG,CAACgG,MAAM,cAAAL,WAAA,uBAAVA,WAAA,CAAYM,UAAU,cAAAV,IAAA,cAAAA,IAAA,GAAI,SAAS;;EAE/F;EACA,IAAIQ,gBAAgB,KAAK,SAAS,IAAIA,gBAAgB,KAAK,OAAO,EAAE;IAClE;EACF;EAEA,MAAMG,sBAAsB,IAAAN,YAAA,GAAG5F,GAAG,CAACgG,MAAM,cAAAJ,YAAA,uBAAVA,YAAA,CAAYO,KAAK;EAChD,IAAI,CAACD,sBAAsB,EAAE;IAC3B/O,kBAAM,CAACC,MAAM,CAACiI,IAAI,CACf,kBAAiB/H,gBAAK,CAAC8O,MAAM,CAAC,cAAc,CAAE,UAAS9O,gBAAK,CAAC8O,MAAM,CAClE,UACF,CAAE,4DACJ,CAAC;IACD;EACF;EACA,MAAMC,kBAAkB,GAAG,MAAMC,sBAAU,CAACC,uBAAuB,CACjE9G,WAAW,EACXyG,sBACF,CAAC;EACD,IAAI,CAACG,kBAAkB,EAAE;IACvBlP,kBAAM,CAACC,MAAM,CAACiI,IAAI,CACf,sDAAqD/H,gBAAK,CAAC8O,MAAM,CAChEF,sBACF,CAAE,yBACJ,CAAC;IACD;EACF;EAEA,MAAMM,aAAa,IAAAX,aAAA,GAAG7F,GAAG,CAACiB,OAAO,cAAA4E,aAAA,uBAAXA,aAAA,CAAaG,MAAM;EACzC,MAAMS,mBAAmB,GAAG,EAAE;EAC9B,KAAK,MAAM;IAAErB,GAAG;IAAEC;EAAe,CAAC,IAAIF,0BAA0B,EAAE;IAChE,MAAMuB,iBAAiB,GAAGF,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAGpB,GAAG,CAAC;IAC9C,IAAIsB,iBAAiB,EAAE;MACrB,MAAMC,WAAW,GAAG,MAAML,sBAAU,CAACC,uBAAuB,CAAC9G,WAAW,EAAEiH,iBAAiB,CAAC;MAC5F,IAAI,CAACC,WAAW,EAAE;QAChBxP,kBAAM,CAACC,MAAM,CAACiI,IAAI,CACf,sDAAqD/H,gBAAK,CAAC8O,MAAM,CAChEM,iBACF,CAAE,yBACJ,CAAC;QACD;MACF;MACA,MAAM;QAAEE,KAAK;QAAEC;MAAO,CAAC,GAAGF,WAAW;MACrC,MAAMG,aAAa,GAAGzB,cAAc,GAAGgB,kBAAkB,CAACO,KAAK;MAC/D,MAAMG,cAAc,GAAG1B,cAAc,GAAGgB,kBAAkB,CAACQ,MAAM;MACjEJ,mBAAmB,CAACvB,IAAI,CAAC;QACvBE,GAAG;QACHwB,KAAK;QACLC,MAAM;QACNC,aAAa;QACbC,cAAc;QACdC,WAAW,EAAEJ,KAAK,KAAKE,aAAa,IAAID,MAAM,KAAKE;MACrD,CAAC,CAAC;IACJ;EACF;EAEA,IAAIN,mBAAmB,CAACjQ,MAAM,KAAK,CAAC,EAAE;IACpCW,kBAAM,CAACC,MAAM,CACViI,IAAI,CAAE;AACb,wEAAwE/H,gBAAK,CAACC,IAAI,CAC5E,+BACF,CAAE;AACN,+GAA+G,CAAC;IAC5G;EACF;EAEA,IAAIkP,mBAAmB,CAACQ,IAAI,CAAC,CAAC;IAAED;EAAY,CAAC,KAAK,CAACA,WAAW,CAAC,EAAE;IAC/D7P,kBAAM,CAACC,MAAM,CACViI,IAAI,CAAE;AACb,qEAAqEoH,mBAAmB,CACjFpR,GAAG,CACF,CAAC;MAAE+P,GAAG;MAAEwB,KAAK;MAAEC,MAAM;MAAEC,aAAa;MAAEC;IAAe,CAAC,KACnD,GAAE3B,GAAI,KAAIwB,KAAM,IAAGC,MAAO,KAAIC,aAAc,IAAGC,cAAe,GACnE,CAAC,CACArM,IAAI,CAAC,IAAI,CAAE;AAClB,+GAA+G,CAAC;EAC9G;AACF;AAEO,eAAewM,uBAAuBA,CAAA,EAAG;EAC9C,IAAI/S,WAAW,KAAK,IAAI,EAAE;IACxB,OAAO,KAAK;EACd;EAEA,IAAI;IACF,MAAM2B,iBAAiB,CAAC,CAAC,aAAa,CAAC,CAAC;IACxC,OAAO,IAAI;EACb,CAAC,CAAC,MAAM;IACN,OAAO,KAAK;EACd;AACF;AAEA,SAASqR,kBAAkBA,CAACjQ,MAAc,EAAE;EAC1C,MAAMkQ,QAAQ,GAAGlQ,MAAM,CAAC1B,QAAQ;EAChC,IAAI,CAAC4R,QAAQ,EAAE;IACb;IACA,OAAQC,IAAY,IAAKA,IAAI;EAC/B;EACA;EACA,IAAInQ,MAAM,CAACzB,YAAY,EAAE;IACvB,OAAO6B,gBAAK,CAACC,IAAI;EACnB;EACA;EACA,OAAQ8P,IAAY,IAAK/P,gBAAK,CAACC,IAAI,CAACD,gBAAK,CAAC0M,IAAI,CAACqD,IAAI,CAAC,CAAC;AACvD;AAEO,eAAevD,oBAAoBA,CAAC9F,OAAiB,EAA0B;EACpF;;EAEA;EACA0C,mBAAO,CAAC4G,iBAAiB,CAAC,CAAC;EAE3B,MAAM;IAAEC;EAAM,CAAC,GAAG,MAAM,IAAAC,kBAAO,EAAC;IAC9BjS,IAAI,EAAE,cAAc;IACpBD,IAAI,EAAE,OAAO;IACbmS,KAAK,EAAE,EAAE;IACT7O,OAAO,EAAE,0BAA0B;IACnC8O,OAAO,EAAE1J,OAAO,CAAC3I,GAAG,CAACsS,IAAI,IAAI;MAC3B,MAAMC,MAAM,GAAGT,kBAAkB,CAACQ,IAAI,CAAC;MACvC,MAAMpS,IAAI,GAAGoS,IAAI,CAAClS,YAAY,GAAGkS,IAAI,CAACpS,IAAI,GAAG,cAAc;MAC3D,OAAO;QACLsS,KAAK,EAAG,GAAED,MAAM,CAACD,IAAI,CAACrS,IAAI,CAAE,IAAGgC,gBAAK,CAACgI,GAAG,CAAE,IAAG/J,IAAK,GAAE,CAAE,EAAC;QACvDgS,KAAK,EAAEI,IAAI,CAACrS;MACd,CAAC;IACH,CAAC,CAAC;IACFwS,OAAO,EAAEA,CAACC,KAAU,EAAEL,OAAY,KAAK;MACrC,MAAM9L,KAAK,GAAG,IAAIoM,MAAM,CAACD,KAAK,EAAE,GAAG,CAAC;MACpC,OAAOL,OAAO,CAACvS,MAAM,CAAE8S,MAAW,IAAKrM,KAAK,CAACsM,IAAI,CAACD,MAAM,CAACJ,KAAK,CAAC,CAAC;IAClE;EACF,CAAC,CAAC;;EAEF;EACAnH,mBAAO,CAACyH,kBAAkB,CAAC,CAAC;EAE5B,MAAMjR,MAAM,GAAGqQ,KAAK,GAAGvJ,OAAO,CAAC5F,IAAI,CAAC,CAAC;IAAE9C;EAAK,CAAC,KAAKA,IAAI,KAAKiS,KAAK,CAAC,GAAI,IAAI;EAEzE,IAAI,CAAArQ,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEzB,YAAY,MAAK,KAAK,EAAE;IAClC2J,eAAe,CAAClI,MAAM,CAAC;IACvB,OAAO,IAAI;EACb;EAEA,OAAOA,MAAM;AACf;AAAC,IAEWkR,SAAS;AAAAC,OAAA,CAAAD,SAAA,GAAAA,SAAA;AAAA,WAATA,SAAS;EAATA,SAAS;EAATA,SAAS;EAATA,SAAS;EAATA,SAAS;EAATA,SAAS;EAATA,SAAS;EAATA,SAAS;AAAA,GAATA,SAAS,KAAAC,OAAA,CAAAD,SAAA,GAATA,SAAS;AAerB,MAAME,gBAAkD,GAAG,CAAC,CAAC;AAE7D,MAAMC,gBAAgB,GAAG,0BAA0B;AACnD;AACA,MAAMC,gBAAgB,GAAG,sBAAsB;AAC/C;AACA,MAAMC,aAAa,GAAG,oBAAoB;AAC1C,MAAMC,qBAAqB,GAAG,wBAAwB;AACtD,MAAM3R,yBAAyB,GAAG,mBAAmB;AAErD,MAAM4R,iCAAiC,GAAG,EAAE;;AAE5C;AACA;AACA;AACO,eAAeC,wBAAwBA,CAC5C1R,MAAoC,EACnB;EACjB,OAAO,MAAM2R,yBAAyB,CAAC3R,MAAM,EAAEqR,gBAAgB,CAAC;AAClE;;AAEA;AACA;AACA;AACO,eAAeO,wBAAwBA,CAC5C5R,MAAoC,EACnB;EAAA,IAAA6R,qBAAA;EACjB,MAAM/M,UAAU,IAAA+M,qBAAA,GACb,MAAMF,yBAAyB,CAAC3R,MAAM,EAAEsR,gBAAgB,CAAC,cAAAO,qBAAA,cAAAA,qBAAA,GAC1DJ,iCAAiC;EACnC,OAAOK,QAAQ,CAAChN,UAAU,EAAE,EAAE,CAAC;AACjC;AAEO,eAAeiN,kBAAkBA,CACtC/R,MAAoC,EACd;EACtB,MAAMgS,UAAU,GAAG,MAAML,yBAAyB,CAAC3R,MAAM,EAAEwR,qBAAqB,CAAC;EAEjF,IAAIQ,UAAU,EAAE;IACd,OAAOA,UAAU,CAACrT,IAAI,CAAC,CAAC,CAACb,KAAK,CAAC,GAAG,CAAC;EACrC;EAEA,MAAMmU,GAAG,GAAI,MAAMN,yBAAyB,CAAC3R,MAAM,EAAEuR,aAAa,CAAe;EACjF,OAAO,CAACU,GAAG,CAAC;AACd;AAEO,eAAeN,yBAAyBA,CAC7C3R,MAAoC,EACpC5B,IAAY,EACZ8T,aAAuB,EACN;EACjB,IAAIA,aAAa,EAAE;IACjB,OAAOd,gBAAgB,CAACpR,MAAM,CAAC5B,IAAI,CAAC;EACtC;EAEA,IAAIgT,gBAAgB,CAACpR,MAAM,CAAC5B,IAAI,CAAC,IAAI,IAAI,EAAE;IACzC,IAAI;MACFgT,gBAAgB,CAACpR,MAAM,CAAC5B,IAAI,CAAC,GAAG,MAAMwB,6BAA6B,CAACI,MAAM,CAAC;IAC7E,CAAC,CAAC,OAAOkH,KAAU,EAAE;MACnB;MACAjH,kBAAM,CAACC,MAAM,CAACgH,KAAK,CAChB,wCAAuClH,MAAM,CAAC5B,IAAK,MAAK4B,MAAM,CAACN,GAAI,MAAKwH,KAAK,CAACxF,OAAQ,EACzF,CAAC;IACH;EACF;EACA,OAAO0P,gBAAgB,CAACpR,MAAM,CAAC5B,IAAI,CAAC,CAACA,IAAI,CAAC;AAC5C;AAEA,eAAewB,6BAA6BA,CAC1CI,MAA2B,EAC3BmS,IAAa,EACc;EAC3B;EACA,MAAMC,WAAW,GAAGlO,UAAU,CAAC,GAAG,CAAClE,MAAM,CAACN,GAAG,EAAE,OAAO,EAAE,SAAS,EAAEyS,IAAI,CAAC,CAAClU,MAAM,CAACC,OAAO,CAAC,CAAC;EACzF,IAAI;IACF;IACA,MAAMmU,OAAO,GAAG,CAAC,MAAM1O,qBAAqB,CAACyO,WAAW,EAAE,QAAQ,CAAC,EAAEE,QAAQ,CAAC,QAAQ,CAAC;IACvF;IACA;IACA;;IAEA,IAAIH,IAAI,EAAE;MACR,OAAO;QACL,CAACA,IAAI,GAAGE;MACV,CAAC;IACH;IACA,OAAOE,wBAAwB,CAACF,OAAO,CAAC;EAC1C,CAAC,CAAC,OAAOnL,KAAU,EAAE;IACnB;IACA,MAAM,IAAI1H,KAAK,CAAE,wCAAuCQ,MAAM,CAACN,GAAI,MAAKwH,KAAK,CAACxF,OAAQ,EAAC,CAAC;EAC1F;AACF;AAEO,SAAS6Q,wBAAwBA,CAACC,sBAA8B,EAAE;EACvE,MAAMC,UAA4B,GAAG,CAAC,CAAC;EACvC,MAAMC,WAAW,GAAG,wBAAwB;EAC5C,KAAK,MAAM5S,KAAK,IAAI0S,sBAAsB,CAACG,QAAQ,CAACD,WAAW,CAAC,EAAE;IAChED,UAAU,CAAC3S,KAAK,CAAC,CAAC,CAAC,CAAC,GAAGA,KAAK,CAAC,CAAC,CAAC;EACjC;EACA,OAAO2S,UAAU;AACnB"}